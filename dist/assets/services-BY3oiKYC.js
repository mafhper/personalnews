class hn{constructor(){this.logs=[],this.maxLogs=100,this.listeners=[],this.originalConsole={log:console.log,warn:console.warn,error:console.error,info:console.info,debug:console.debug},this.init()}init(){console.log=(...e)=>{this.addLog("log",e),this.originalConsole.log(...e)},console.info=(...e)=>{this.addLog("info",e),this.originalConsole.info(...e)},console.warn=(...e)=>{this.addLog("warn",e),this.originalConsole.warn(...e)},console.error=(...e)=>{this.addLog("error",e),this.originalConsole.error(...e)}}addLog(e,t){const r=t.map(i=>typeof i=="object"?JSON.stringify(i,null,2):String(i)).join(" "),s={id:Math.random().toString(36).substr(2,9),timestamp:Date.now(),type:e,message:r,data:t};this.logs=[s,...this.logs].slice(0,this.maxLogs),this.notifyListeners()}getLogs(){return this.logs}clearLogs(){this.logs=[],this.notifyListeners()}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}log(...e){this.addLog("log",e),this.originalConsole.log(...e)}info(...e){this.addLog("info",e),this.originalConsole.info(...e)}warn(...e){this.addLog("warn",e),this.originalConsole.warn(...e)}error(...e){this.addLog("error",e),this.originalConsole.error(...e)}debug(...e){this.addLog("debug",e),this.originalConsole.debug?this.originalConsole.debug(...e):this.originalConsole.log("[DEBUG]",...e)}notifyListeners(){this.listeners.forEach(e=>e(this.logs))}}const v=new hn,pn=()=>v,fr=n=>v,Yt=600*1e3,Vt=100,Kt=7200*1e3,it="smart-feed-cache";class gn{constructor(e={}){this.cache=new Map,this.stats={hits:0,misses:0,sets:0,evictions:0},this.options={ttl:e.ttl||Yt,maxEntries:e.maxEntries||Vt,enablePersistence:e.enablePersistence!==!1,enableStaleWhileRevalidate:e.enableStaleWhileRevalidate||Kt},this.options.enablePersistence&&this.loadFromStorage(),this.setupPeriodicCleanup()}get(e){const t=this.cache.get(e);if(!t)return this.stats.misses++,null;const r=Date.now(),s=r-t.timestamp;return t.accessCount++,t.lastAccessed=r,s<=this.options.ttl?(this.stats.hits++,v.debug("Cache hit for feed (fresh)",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(s/1e3),ttl:Math.round(this.options.ttl/1e3),articlesCount:t.articles.length}}),t.articles):s<=this.options.enableStaleWhileRevalidate?(this.stats.hits++,v.debug("Cache hit for feed (stale)",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(s/1e3),staleLimit:Math.round(this.options.enableStaleWhileRevalidate/1e3),articlesCount:t.articles.length}}),t.articles):(this.cache.delete(e),this.stats.misses++,v.debug("Cache expired for feed",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(s/1e3),staleLimit:Math.round(this.options.enableStaleWhileRevalidate/1e3)}}),null)}getStaleWhileRevalidate(e){const t=this.cache.get(e);if(!t)return null;const r=Date.now(),s=r-t.timestamp;return s<=this.options.enableStaleWhileRevalidate?(t.lastAccessed=r,v.debug("Serving stale content while revalidating",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(s/1e3),articlesCount:t.articles.length}}),t.articles):null}isFresh(e){const t=this.cache.get(e);return t?Date.now()-t.timestamp<=this.options.ttl:!1}isStale(e){const t=this.cache.get(e);if(!t)return!1;const r=Date.now()-t.timestamp;return r>this.options.ttl&&r<=this.options.enableStaleWhileRevalidate}set(e,t,r,s){const i=Date.now(),a={articles:t.map(f=>({...f,pubDate:new Date(f.pubDate)})),timestamp:i,feedUrl:e,title:r,etag:s?.get("etag")||void 0,lastModified:s?.get("last-modified")||void 0,accessCount:1,lastAccessed:i};this.cache.size>=this.options.maxEntries&&this.evictLeastRecentlyUsed(),this.cache.set(e,a),this.stats.sets++,v.debug("Cached articles for feed",{component:"SmartCache",additionalData:{feedUrl:e,articlesCount:t.length,title:r,hasEtag:!!a.etag,hasLastModified:!!a.lastModified,cacheSize:this.cache.size}}),this.options.enablePersistence&&this.persistToStorage()}delete(e){const t=this.cache.delete(e);return t&&(v.debug("Removed cache entry for feed",{component:"SmartCache",additionalData:{feedUrl:e}}),this.options.enablePersistence&&this.persistToStorage()),t}clear(){const e=this.cache.size;this.cache.clear(),v.info("Cleared all cache entries",{component:"SmartCache",additionalData:{clearedEntries:e}}),this.options.enablePersistence&&this.persistToStorage()}getStats(){const e=Array.from(this.cache.values()),t=e.reduce((i,a)=>i+a.articles.length,0),r=e.map(i=>i.timestamp),s=this.stats.hits+this.stats.misses>0?this.stats.hits/(this.stats.hits+this.stats.misses):0;return{totalEntries:this.cache.size,totalArticles:t,cacheSize:this.estimateCacheSize(),hitRate:s,oldestEntry:r.length>0?Math.min(...r):0,newestEntry:r.length>0?Math.max(...r):0}}getKeys(){return Array.from(this.cache.keys())}has(e){return this.cache.has(e)}getMetadata(e){const t=this.cache.get(e);if(!t)return null;const{articles:r,...s}=t;return s}cleanup(){const e=Date.now(),t=[];for(const[r,s]of this.cache.entries())e-s.timestamp>this.options.enableStaleWhileRevalidate&&t.push(r);return t.forEach(r=>this.cache.delete(r)),t.length>0&&(v.info("Cleaned up expired cache entries",{component:"SmartCache",additionalData:{expiredCount:t.length,remainingCount:this.cache.size}}),this.options.enablePersistence&&this.persistToStorage()),t.length}evictLeastRecentlyUsed(){let e=null,t=Date.now();for(const[r,s]of this.cache.entries())s.lastAccessed<t&&(t=s.lastAccessed,e=r);e&&(this.cache.delete(e),this.stats.evictions++,v.debug("Evicted LRU cache entry",{component:"SmartCache",additionalData:{evictedKey:e,lastAccessed:new Date(t).toISOString()}}))}estimateCacheSize(){let e=0;for(const t of this.cache.values())e+=JSON.stringify(t).length*2;return e}loadFromStorage(){try{const e=localStorage.getItem(it);if(!e)return;const t=JSON.parse(e),r=Date.now();for(const[s,i]of t.entries||[]){const a={...i,articles:i.articles.map(p=>({...p,pubDate:new Date(p.pubDate)}))};r-a.timestamp<=this.options.enableStaleWhileRevalidate&&this.cache.set(s,a)}v.info("Loaded cache from storage",{component:"SmartCache",additionalData:{loadedEntries:this.cache.size,totalStored:t.entries?.length||0}})}catch(e){v.error("Failed to load cache from storage",e,{component:"SmartCache"}),localStorage.removeItem(it)}}persistToStorage(){try{const e=Array.from(this.cache.entries()).map(([r,s])=>[r,{...s,articles:s.articles.map(i=>({...i,pubDate:i.pubDate.toISOString()}))}]),t={entries:e,timestamp:Date.now(),version:"1.0.0"};localStorage.setItem(it,JSON.stringify(t)),v.debug("Persisted cache to storage",{component:"SmartCache",additionalData:{entriesCount:e.length,estimatedSize:JSON.stringify(t).length}})}catch(e){v.error("Failed to persist cache to storage",e,{component:"SmartCache",additionalData:{cacheSize:this.cache.size,estimatedSize:this.estimateCacheSize()}})}}setupPeriodicCleanup(){setInterval(()=>{this.cleanup()},300*1e3)}}const Et=new gn({ttl:Yt,maxEntries:Vt,enablePersistence:!0,enableStaleWhileRevalidate:Kt}),En=n=>Et.get(n),Tn=(n,e,t,r)=>{Et.set(n,e,t,r)},dr=n=>Et.isFresh(n),Jt={maxXmlSize:10*1024*1024,allowedRootElements:["rss","feed","rdf:rdf","rdf"],blockedPatterns:[/<!ENTITY[^>]*SYSTEM/i,/<!ENTITY[^>]*PUBLIC/i,/javascript:/gi,/vbscript:/gi]};function yn(n,e){if(n.length>e.maxXmlSize)throw new Error(`XML size exceeds security limit of ${e.maxXmlSize} bytes`);for(const t of e.blockedPatterns)if(t.test(n))throw new Error("Potentially malicious XML content detected: blocked pattern found")}function An(n,e){const t=n.documentElement;if(!t)throw new Error("No valid XML root element found");const r=t.tagName.toLowerCase();if(!e.allowedRootElements.some(i=>r===i.toLowerCase()))throw new Error(`Root element '${r}' is not in allowed list: ${e.allowedRootElements.join(", ")}`);const s=Array.from(n.childNodes).filter(i=>i.nodeType===Node.ELEMENT_NODE);if(s.length>1)throw new Error(`XML contains ${s.length} root nodes, but only 1 is allowed`)}function Sn(n,e=Jt){try{if(!n||typeof n!="string")throw new Error("Invalid XML input: must be a non-empty string");const t=n.trim();if(!t)throw new Error("Invalid XML input: must be a non-empty string");yn(t,e);const s=new DOMParser().parseFromString(t,"application/xml"),i=s.querySelector("parsererror");if(i)throw new Error(`XML parsing error: ${i.textContent}`);return An(s,e),s}catch(t){throw console.error("Secure XML parsing error:",t),new Error(`Failed to parse XML securely: ${t instanceof Error?t.message:"Unknown error"}`)}}function bn(n){const e={...Jt,allowedRootElements:["rss","feed","rdf:rdf","rdf"]};return Sn(n,e)}const wn=[{original:"http://feeds.feedburner.com/tecnoblog",alternatives:["https://tecnoblog.net/feed/","https://tecnoblog.net/rss/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/Techcrunch",alternatives:["https://techcrunch.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/blogdoiphone/rss",alternatives:["https://blogdoiphone.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://macmagazine.com.br/feed/",alternatives:["https://macmagazine.com.br/feed/"],notes:"HTTP to HTTPS redirect"},{original:"http://feeds2.feedburner.com/canaltechbr",alternatives:["https://canaltech.com.br/rss/","https://canaltech.com.br/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/guiadopc",alternatives:["https://guiadopc.com.br/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://meiobit.com/index.xml",alternatives:["https://meiobit.com/feed/","https://meiobit.com/index.xml"],notes:"HTTP to HTTPS redirect"},{original:"http://feeds.feedburner.com/design-milk",alternatives:["https://design-milk.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/core77/blog",alternatives:["https://www.core77.com/rss/object.xml"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/dezeen",alternatives:["https://www.dezeen.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/JustCreativeDesignBlog",alternatives:["https://justcreative.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds2.feedburner.com/thenextweb",alternatives:["https://thenextweb.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/brainstorm9",alternatives:["https://www.brainstorm9.com/feed/"],notes:"FeedBurner redirect to direct feed"}];function _n(n){const e=[n],t=wn.find(r=>r.original===n);if(t&&e.push(...t.alternatives),n.startsWith("http://")){const r=n.replace("http://","https://");e.includes(r)||e.push(r)}return[...new Set(e)]}const{entries:qt,setPrototypeOf:Pt,isFrozen:Cn,getPrototypeOf:Rn,getOwnPropertyDescriptor:Dn}=Object;let{freeze:M,seal:W,create:dt}=Object,{apply:ht,construct:pt}=typeof Reflect<"u"&&Reflect;M||(M=function(e){return e});W||(W=function(e){return e});ht||(ht=function(e,t){for(var r=arguments.length,s=new Array(r>2?r-2:0),i=2;i<r;i++)s[i-2]=arguments[i];return e.apply(t,s)});pt||(pt=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return new e(...r)});const ze=O(Array.prototype.forEach),xn=O(Array.prototype.lastIndexOf),kt=O(Array.prototype.pop),Se=O(Array.prototype.push),Nn=O(Array.prototype.splice),He=O(String.prototype.toLowerCase),at=O(String.prototype.toString),ct=O(String.prototype.match),be=O(String.prototype.replace),In=O(String.prototype.indexOf),Ln=O(String.prototype.trim),$=O(Object.prototype.hasOwnProperty),L=O(RegExp.prototype.test),we=vn(TypeError);function O(n){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return ht(n,e,r)}}function vn(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return pt(n,t)}}function h(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:He;Pt&&Pt(n,null);let r=e.length;for(;r--;){let s=e[r];if(typeof s=="string"){const i=t(s);i!==s&&(Cn(e)||(e[r]=i),s=i)}n[s]=!0}return n}function Mn(n){for(let e=0;e<n.length;e++)$(n,e)||(n[e]=null);return n}function Y(n){const e=dt(null);for(const[t,r]of qt(n))$(n,t)&&(Array.isArray(r)?e[t]=Mn(r):r&&typeof r=="object"&&r.constructor===Object?e[t]=Y(r):e[t]=r);return e}function _e(n,e){for(;n!==null;){const r=Dn(n,e);if(r){if(r.get)return O(r.get);if(typeof r.value=="function")return O(r.value)}n=Rn(n)}function t(){return null}return t}const zt=M(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),lt=M(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),ut=M(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),On=M(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),mt=M(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Fn=M(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ut=M(["#text"]),Bt=M(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),ft=M(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ht=M(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Ue=M(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Pn=W(/\{\{[\w\W]*|[\w\W]*\}\}/gm),kn=W(/<%[\w\W]*|[\w\W]*%>/gm),zn=W(/\$\{[\w\W]*/gm),Un=W(/^data-[\-\w.\u00B7-\uFFFF]+$/),Bn=W(/^aria-[\-\w]+$/),Zt=W(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Hn=W(/^(?:\w+script|data):/i),Wn=W(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Qt=W(/^html$/i),$n=W(/^[a-z][.\w]*(-[.\w]+)+$/i);var Wt=Object.freeze({__proto__:null,ARIA_ATTR:Bn,ATTR_WHITESPACE:Wn,CUSTOM_ELEMENT:$n,DATA_ATTR:Un,DOCTYPE_NAME:Qt,ERB_EXPR:kn,IS_ALLOWED_URI:Zt,IS_SCRIPT_OR_DATA:Hn,MUSTACHE_EXPR:Pn,TMPLIT_EXPR:zn});const Ce={element:1,text:3,progressingInstruction:7,comment:8,document:9},Gn=function(){return typeof window>"u"?null:window},jn=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const s="data-tt-policy-suffix";t&&t.hasAttribute(s)&&(r=t.getAttribute(s));const i="dompurify"+(r?"#"+r:"");try{return e.createPolicy(i,{createHTML(a){return a},createScriptURL(a){return a}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}},$t=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function en(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Gn();const e=u=>en(u);if(e.version="3.3.1",e.removed=[],!n||!n.document||n.document.nodeType!==Ce.document||!n.Element)return e.isSupported=!1,e;let{document:t}=n;const r=t,s=r.currentScript,{DocumentFragment:i,HTMLTemplateElement:a,Node:f,Element:p,NodeFilter:m,NamedNodeMap:A=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:S,DOMParser:k,trustedTypes:z}=n,F=p.prototype,De=_e(F,"cloneNode"),$e=_e(F,"remove"),Ge=_e(F,"nextSibling"),je=_e(F,"childNodes"),ee=_e(F,"parentNode");if(typeof a=="function"){const u=t.createElement("template");u.content&&u.content.ownerDocument&&(t=u.content.ownerDocument)}let b,U="";const{implementation:se,createNodeIterator:Xe,createDocumentFragment:Ye,getElementsByTagName:Ve}=t,{importNode:Ke}=r;let D=$t();e.isSupported=typeof qt=="function"&&typeof ee=="function"&&se&&se.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:ie,ERB_EXPR:pe,TMPLIT_EXPR:ge,DATA_ATTR:xe,ARIA_ATTR:Je,IS_SCRIPT_OR_DATA:qe,ATTR_WHITESPACE:Ne,CUSTOM_ELEMENT:Ie}=Wt;let{IS_ALLOWED_URI:Ee}=Wt,_=null;const V=h({},[...zt,...lt,...ut,...mt,...Ut]);let w=null;const te=h({},[...Bt,...ft,...Ht,...Ue]);let T=Object.seal(dt(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Q=null,ae=null;const K=Object.seal(dt(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let ce=!0,Te=!0,Le=!1,ve=!0,B=!1,ne=!0,d=!1,E=!1,I=!1,H=!1,le=!1,Me=!1,yt=!0,At=!1;const sn="user-content-";let Ze=!0,ye=!1,ue={},G=null;const Qe=h({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let St=null;const bt=h({},["audio","video","img","source","image","track"]);let et=null;const wt=h({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Oe="http://www.w3.org/1998/Math/MathML",Fe="http://www.w3.org/2000/svg",J="http://www.w3.org/1999/xhtml";let me=J,tt=!1,nt=null;const an=h({},[Oe,Fe,J],at);let Pe=h({},["mi","mo","mn","ms","mtext"]),ke=h({},["annotation-xml"]);const cn=h({},["title","style","font","a","script"]);let Ae=null;const ln=["application/xhtml+xml","text/html"],un="text/html";let R=null,fe=null;const mn=t.createElement("form"),_t=function(o){return o instanceof RegExp||o instanceof Function},rt=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(fe&&fe===o)){if((!o||typeof o!="object")&&(o={}),o=Y(o),Ae=ln.indexOf(o.PARSER_MEDIA_TYPE)===-1?un:o.PARSER_MEDIA_TYPE,R=Ae==="application/xhtml+xml"?at:He,_=$(o,"ALLOWED_TAGS")?h({},o.ALLOWED_TAGS,R):V,w=$(o,"ALLOWED_ATTR")?h({},o.ALLOWED_ATTR,R):te,nt=$(o,"ALLOWED_NAMESPACES")?h({},o.ALLOWED_NAMESPACES,at):an,et=$(o,"ADD_URI_SAFE_ATTR")?h(Y(wt),o.ADD_URI_SAFE_ATTR,R):wt,St=$(o,"ADD_DATA_URI_TAGS")?h(Y(bt),o.ADD_DATA_URI_TAGS,R):bt,G=$(o,"FORBID_CONTENTS")?h({},o.FORBID_CONTENTS,R):Qe,Q=$(o,"FORBID_TAGS")?h({},o.FORBID_TAGS,R):Y({}),ae=$(o,"FORBID_ATTR")?h({},o.FORBID_ATTR,R):Y({}),ue=$(o,"USE_PROFILES")?o.USE_PROFILES:!1,ce=o.ALLOW_ARIA_ATTR!==!1,Te=o.ALLOW_DATA_ATTR!==!1,Le=o.ALLOW_UNKNOWN_PROTOCOLS||!1,ve=o.ALLOW_SELF_CLOSE_IN_ATTR!==!1,B=o.SAFE_FOR_TEMPLATES||!1,ne=o.SAFE_FOR_XML!==!1,d=o.WHOLE_DOCUMENT||!1,H=o.RETURN_DOM||!1,le=o.RETURN_DOM_FRAGMENT||!1,Me=o.RETURN_TRUSTED_TYPE||!1,I=o.FORCE_BODY||!1,yt=o.SANITIZE_DOM!==!1,At=o.SANITIZE_NAMED_PROPS||!1,Ze=o.KEEP_CONTENT!==!1,ye=o.IN_PLACE||!1,Ee=o.ALLOWED_URI_REGEXP||Zt,me=o.NAMESPACE||J,Pe=o.MATHML_TEXT_INTEGRATION_POINTS||Pe,ke=o.HTML_INTEGRATION_POINTS||ke,T=o.CUSTOM_ELEMENT_HANDLING||{},o.CUSTOM_ELEMENT_HANDLING&&_t(o.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(T.tagNameCheck=o.CUSTOM_ELEMENT_HANDLING.tagNameCheck),o.CUSTOM_ELEMENT_HANDLING&&_t(o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(T.attributeNameCheck=o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),o.CUSTOM_ELEMENT_HANDLING&&typeof o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(T.allowCustomizedBuiltInElements=o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),B&&(Te=!1),le&&(H=!0),ue&&(_=h({},Ut),w=[],ue.html===!0&&(h(_,zt),h(w,Bt)),ue.svg===!0&&(h(_,lt),h(w,ft),h(w,Ue)),ue.svgFilters===!0&&(h(_,ut),h(w,ft),h(w,Ue)),ue.mathMl===!0&&(h(_,mt),h(w,Ht),h(w,Ue))),o.ADD_TAGS&&(typeof o.ADD_TAGS=="function"?K.tagCheck=o.ADD_TAGS:(_===V&&(_=Y(_)),h(_,o.ADD_TAGS,R))),o.ADD_ATTR&&(typeof o.ADD_ATTR=="function"?K.attributeCheck=o.ADD_ATTR:(w===te&&(w=Y(w)),h(w,o.ADD_ATTR,R))),o.ADD_URI_SAFE_ATTR&&h(et,o.ADD_URI_SAFE_ATTR,R),o.FORBID_CONTENTS&&(G===Qe&&(G=Y(G)),h(G,o.FORBID_CONTENTS,R)),o.ADD_FORBID_CONTENTS&&(G===Qe&&(G=Y(G)),h(G,o.ADD_FORBID_CONTENTS,R)),Ze&&(_["#text"]=!0),d&&h(_,["html","head","body"]),_.table&&(h(_,["tbody"]),delete Q.tbody),o.TRUSTED_TYPES_POLICY){if(typeof o.TRUSTED_TYPES_POLICY.createHTML!="function")throw we('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof o.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw we('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');b=o.TRUSTED_TYPES_POLICY,U=b.createHTML("")}else b===void 0&&(b=jn(z,s)),b!==null&&typeof U=="string"&&(U=b.createHTML(""));M&&M(o),fe=o}},Ct=h({},[...lt,...ut,...On]),Rt=h({},[...mt,...Fn]),fn=function(o){let c=ee(o);(!c||!c.tagName)&&(c={namespaceURI:me,tagName:"template"});const l=He(o.tagName),y=He(c.tagName);return nt[o.namespaceURI]?o.namespaceURI===Fe?c.namespaceURI===J?l==="svg":c.namespaceURI===Oe?l==="svg"&&(y==="annotation-xml"||Pe[y]):!!Ct[l]:o.namespaceURI===Oe?c.namespaceURI===J?l==="math":c.namespaceURI===Fe?l==="math"&&ke[y]:!!Rt[l]:o.namespaceURI===J?c.namespaceURI===Fe&&!ke[y]||c.namespaceURI===Oe&&!Pe[y]?!1:!Rt[l]&&(cn[l]||!Ct[l]):!!(Ae==="application/xhtml+xml"&&nt[o.namespaceURI]):!1},j=function(o){Se(e.removed,{element:o});try{ee(o).removeChild(o)}catch{$e(o)}},re=function(o,c){try{Se(e.removed,{attribute:c.getAttributeNode(o),from:c})}catch{Se(e.removed,{attribute:null,from:c})}if(c.removeAttribute(o),o==="is")if(H||le)try{j(c)}catch{}else try{c.setAttribute(o,"")}catch{}},Dt=function(o){let c=null,l=null;if(I)o="<remove></remove>"+o;else{const C=ct(o,/^[\r\n\t ]+/);l=C&&C[0]}Ae==="application/xhtml+xml"&&me===J&&(o='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+o+"</body></html>");const y=b?b.createHTML(o):o;if(me===J)try{c=new k().parseFromString(y,Ae)}catch{}if(!c||!c.documentElement){c=se.createDocument(me,"template",null);try{c.documentElement.innerHTML=tt?U:y}catch{}}const N=c.body||c.documentElement;return o&&l&&N.insertBefore(t.createTextNode(l),N.childNodes[0]||null),me===J?Ve.call(c,d?"html":"body")[0]:d?c.documentElement:N},xt=function(o){return Xe.call(o.ownerDocument||o,o,m.SHOW_ELEMENT|m.SHOW_COMMENT|m.SHOW_TEXT|m.SHOW_PROCESSING_INSTRUCTION|m.SHOW_CDATA_SECTION,null)},ot=function(o){return o instanceof S&&(typeof o.nodeName!="string"||typeof o.textContent!="string"||typeof o.removeChild!="function"||!(o.attributes instanceof A)||typeof o.removeAttribute!="function"||typeof o.setAttribute!="function"||typeof o.namespaceURI!="string"||typeof o.insertBefore!="function"||typeof o.hasChildNodes!="function")},Nt=function(o){return typeof f=="function"&&o instanceof f};function q(u,o,c){ze(u,l=>{l.call(e,o,c,fe)})}const It=function(o){let c=null;if(q(D.beforeSanitizeElements,o,null),ot(o))return j(o),!0;const l=R(o.nodeName);if(q(D.uponSanitizeElement,o,{tagName:l,allowedTags:_}),ne&&o.hasChildNodes()&&!Nt(o.firstElementChild)&&L(/<[/\w!]/g,o.innerHTML)&&L(/<[/\w!]/g,o.textContent)||o.nodeType===Ce.progressingInstruction||ne&&o.nodeType===Ce.comment&&L(/<[/\w]/g,o.data))return j(o),!0;if(!(K.tagCheck instanceof Function&&K.tagCheck(l))&&(!_[l]||Q[l])){if(!Q[l]&&vt(l)&&(T.tagNameCheck instanceof RegExp&&L(T.tagNameCheck,l)||T.tagNameCheck instanceof Function&&T.tagNameCheck(l)))return!1;if(Ze&&!G[l]){const y=ee(o)||o.parentNode,N=je(o)||o.childNodes;if(N&&y){const C=N.length;for(let P=C-1;P>=0;--P){const Z=De(N[P],!0);Z.__removalCount=(o.__removalCount||0)+1,y.insertBefore(Z,Ge(o))}}}return j(o),!0}return o instanceof p&&!fn(o)||(l==="noscript"||l==="noembed"||l==="noframes")&&L(/<\/no(script|embed|frames)/i,o.innerHTML)?(j(o),!0):(B&&o.nodeType===Ce.text&&(c=o.textContent,ze([ie,pe,ge],y=>{c=be(c,y," ")}),o.textContent!==c&&(Se(e.removed,{element:o.cloneNode()}),o.textContent=c)),q(D.afterSanitizeElements,o,null),!1)},Lt=function(o,c,l){if(yt&&(c==="id"||c==="name")&&(l in t||l in mn))return!1;if(!(Te&&!ae[c]&&L(xe,c))){if(!(ce&&L(Je,c))){if(!(K.attributeCheck instanceof Function&&K.attributeCheck(c,o))){if(!w[c]||ae[c]){if(!(vt(o)&&(T.tagNameCheck instanceof RegExp&&L(T.tagNameCheck,o)||T.tagNameCheck instanceof Function&&T.tagNameCheck(o))&&(T.attributeNameCheck instanceof RegExp&&L(T.attributeNameCheck,c)||T.attributeNameCheck instanceof Function&&T.attributeNameCheck(c,o))||c==="is"&&T.allowCustomizedBuiltInElements&&(T.tagNameCheck instanceof RegExp&&L(T.tagNameCheck,l)||T.tagNameCheck instanceof Function&&T.tagNameCheck(l))))return!1}else if(!et[c]){if(!L(Ee,be(l,Ne,""))){if(!((c==="src"||c==="xlink:href"||c==="href")&&o!=="script"&&In(l,"data:")===0&&St[o])){if(!(Le&&!L(qe,be(l,Ne,"")))){if(l)return!1}}}}}}}return!0},vt=function(o){return o!=="annotation-xml"&&ct(o,Ie)},Mt=function(o){q(D.beforeSanitizeAttributes,o,null);const{attributes:c}=o;if(!c||ot(o))return;const l={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:w,forceKeepAttr:void 0};let y=c.length;for(;y--;){const N=c[y],{name:C,namespaceURI:P,value:Z}=N,de=R(C),st=Z;let x=C==="value"?st:Ln(st);if(l.attrName=de,l.attrValue=x,l.keepAttr=!0,l.forceKeepAttr=void 0,q(D.uponSanitizeAttribute,o,l),x=l.attrValue,At&&(de==="id"||de==="name")&&(re(C,o),x=sn+x),ne&&L(/((--!?|])>)|<\/(style|title|textarea)/i,x)){re(C,o);continue}if(de==="attributename"&&ct(x,"href")){re(C,o);continue}if(l.forceKeepAttr)continue;if(!l.keepAttr){re(C,o);continue}if(!ve&&L(/\/>/i,x)){re(C,o);continue}B&&ze([ie,pe,ge],Ft=>{x=be(x,Ft," ")});const Ot=R(o.nodeName);if(!Lt(Ot,de,x)){re(C,o);continue}if(b&&typeof z=="object"&&typeof z.getAttributeType=="function"&&!P)switch(z.getAttributeType(Ot,de)){case"TrustedHTML":{x=b.createHTML(x);break}case"TrustedScriptURL":{x=b.createScriptURL(x);break}}if(x!==st)try{P?o.setAttributeNS(P,C,x):o.setAttribute(C,x),ot(o)?j(o):kt(e.removed)}catch{re(C,o)}}q(D.afterSanitizeAttributes,o,null)},dn=function u(o){let c=null;const l=xt(o);for(q(D.beforeSanitizeShadowDOM,o,null);c=l.nextNode();)q(D.uponSanitizeShadowNode,c,null),It(c),Mt(c),c.content instanceof i&&u(c.content);q(D.afterSanitizeShadowDOM,o,null)};return e.sanitize=function(u){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=null,l=null,y=null,N=null;if(tt=!u,tt&&(u="<!-->"),typeof u!="string"&&!Nt(u))if(typeof u.toString=="function"){if(u=u.toString(),typeof u!="string")throw we("dirty is not a string, aborting")}else throw we("toString is not a function");if(!e.isSupported)return u;if(E||rt(o),e.removed=[],typeof u=="string"&&(ye=!1),ye){if(u.nodeName){const Z=R(u.nodeName);if(!_[Z]||Q[Z])throw we("root node is forbidden and cannot be sanitized in-place")}}else if(u instanceof f)c=Dt("<!---->"),l=c.ownerDocument.importNode(u,!0),l.nodeType===Ce.element&&l.nodeName==="BODY"||l.nodeName==="HTML"?c=l:c.appendChild(l);else{if(!H&&!B&&!d&&u.indexOf("<")===-1)return b&&Me?b.createHTML(u):u;if(c=Dt(u),!c)return H?null:Me?U:""}c&&I&&j(c.firstChild);const C=xt(ye?u:c);for(;y=C.nextNode();)It(y),Mt(y),y.content instanceof i&&dn(y.content);if(ye)return u;if(H){if(le)for(N=Ye.call(c.ownerDocument);c.firstChild;)N.appendChild(c.firstChild);else N=c;return(w.shadowroot||w.shadowrootmode)&&(N=Ke.call(r,N,!0)),N}let P=d?c.outerHTML:c.innerHTML;return d&&_["!doctype"]&&c.ownerDocument&&c.ownerDocument.doctype&&c.ownerDocument.doctype.name&&L(Qt,c.ownerDocument.doctype.name)&&(P="<!DOCTYPE "+c.ownerDocument.doctype.name+`>
`+P),B&&ze([ie,pe,ge],Z=>{P=be(P,Z," ")}),b&&Me?b.createHTML(P):P},e.setConfig=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};rt(u),E=!0},e.clearConfig=function(){fe=null,E=!1},e.isValidAttribute=function(u,o,c){fe||rt({});const l=R(u),y=R(o);return Lt(l,y,c)},e.addHook=function(u,o){typeof o=="function"&&Se(D[u],o)},e.removeHook=function(u,o){if(o!==void 0){const c=xn(D[u],o);return c===-1?void 0:Nn(D[u],c,1)[0]}return kt(D[u])},e.removeHooks=function(u){D[u]=[]},e.removeAllHooks=function(){D=$t()},e}var tn=en();const hr=Object.freeze(Object.defineProperty({__proto__:null,default:tn},Symbol.toStringTag,{value:"Module"})),Tt=tn(typeof window<"u"?window:void 0);Tt.addHook("afterSanitizeAttributes",function(n){"target"in n&&n.tagName==="A"&&(n.setAttribute("target","_blank"),n.setAttribute("rel","noopener noreferrer"))});function nn(n){return n?Tt.sanitize(n,{ALLOWED_TAGS:["p","br","b","i","em","strong","u","a","img","h1","h2","h3","h4","h5","h6","ul","ol","li","blockquote","code","pre","span","div","table","thead","tbody","tr","td","th"],ALLOWED_ATTR:["href","src","alt","title","class","target","rel","width","height"],FORBID_TAGS:["script","style","iframe","object","embed","form","input","button"]}):""}function Xn(n){if(!n)return"";const e=Tt.sanitize(n,{ALLOWED_TAGS:[],KEEP_CONTENT:!0});if(typeof document<"u"){const r=document.createElement("textarea");return r.innerHTML=e,r.value}let t=n;for(let r=0;r<5;r++){const s=t;if(t=t.replace(/&amp;/g,"&"),t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&apos;/g,"'").replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/").replace(/&#(\d+);/g,(i,a)=>String.fromCharCode(parseInt(a,10))).replace(/&#x([0-9a-f]+);/gi,(i,a)=>String.fromCharCode(parseInt(a,16))),t=t.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/on\w+\s*=\s*["'][^"']*["']/gi,"").replace(/javascript:/gi,"").replace(/vbscript:/gi,"").replace(/data:text\/html/gi,"").replace(/<[^>]*>/g,"").replace(/<[^<]*$/g,""),t===s)break}return t=t.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"").trim(),t}function pr(n,e=300){const t=Xn(n);if(t.length<=e)return t;const r=t.substring(0,e),s=r.lastIndexOf(" ");return s>e*.8?r.substring(0,s)+"...":r+"..."}const Yn=15e3,Vn=2,Kn=1e3,oe=pn();async function Jn(n,e={}){const{timeout:t=Yn,...r}=e,s=new AbortController,i=setTimeout(()=>s.abort(),t);try{const a=await fetch(n,{...r,signal:e.signal||s.signal});return clearTimeout(i),a}catch(a){throw clearTimeout(i),a}}const gt={failures:{},threshold:3,resetTime:6e4,lastFailure:{},isOpen(n){return(this.failures[n]||0)>=this.threshold?Date.now()-(this.lastFailure[n]||0)>this.resetTime?(this.failures[n]=0,!1):!0:!1},recordFailure(n){this.failures[n]=(this.failures[n]||0)+1,this.lastFailure[n]=Date.now()},recordSuccess(n){this.failures[n]=0}};function rn(n){return n?n.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim():""}function he(n){return n?n.replace(/[\n\r]+/g," ").trim():"No Title"}function on(n){return n?n.replace(/[\n\r]+/g," ").trim():""}function X(n,e){return n.getAttribute(e)}function qn(n){if(n.length===0)return;n.sort((t,r)=>{const s=(t.width||0)>=800,i=(r.width||0)>=800;if(s&&!i)return-1;if(!s&&i)return 1;const a=t.score+(t.source==="media:content"||t.source==="enclosure"?2:0),f=r.score+(r.source==="media:content"||r.source==="enclosure"?2:0);return t.width&&r.width&&t.width!==r.width?r.width-t.width:t.size&&r.size&&t.size!==r.size?r.size-t.size:f-a});const e=n.filter(t=>!t.width||t.width>50);return e.length>0?e[0].url:n[0].url}function Zn(n,e){let t;try{t=JSON.parse(n)}catch{throw new Error("Failed to parse JSON response")}if(t.status!=="ok"&&!t.items)throw new Error("Invalid RSS2JSON response format");const r=he(t.feed?.title||"Untitled Feed"),s=[],i=t.items||[];for(const a of i)try{const f=he(a.title||"No Title"),p=a.link||"",m=new Date(a.pubDate||a.created||Date.now()),A=rn(a.description||a.content||"").substring(0,500),S=nn(a.content||a.description||""),k=on(a.author||""),z=Array.isArray(a.categories)?a.categories:[];let F=a.thumbnail||a.enclosure?.link;F&&!F.startsWith("http")&&(F=void 0),f!=="No Title"&&p&&s.push({title:f,link:p,pubDate:m,description:A,content:S,imageUrl:F,author:k,categories:z,sourceTitle:r})}catch{oe.warn("Failed to parse JSON item",{component:"rssParser"})}return{title:r,articles:s}}function Gt(n,e){const t=bn(n),r=t.getElementsByTagName("parsererror");if(r.length>0)throw new Error(`XML parsing error: ${r[0].textContent}`);let s="Untitled Feed",i;const a=t.getElementsByTagName("channel");if(a.length>0)s=a[0].getElementsByTagName("title")[0]?.textContent?.trim()||"Untitled Feed",s=he(s),i=t.getElementsByTagName("item");else{const p=t.getElementsByTagName("feed");if(p.length>0)s=p[0].getElementsByTagName("title")[0]?.textContent?.trim()||"Untitled Feed",s=he(s),i=t.getElementsByTagName("entry");else{const m=t.getElementsByTagName("item");if(m.length>0){const A=t.getElementsByTagName("channel");A.length>0&&(s=A[0].getElementsByTagName("title")[0]?.textContent?.trim()||"Untitled Feed",s=he(s)),i=m}else throw new Error("Unsupported RSS format")}}const f=[];for(let p=0;p<Math.min(i.length,50);p++){const m=i[p];try{const S=m.getElementsByTagName("title")[0]?.textContent?.trim()||"No Title",k=he(S);let z="";const F=m.getElementsByTagName("link");F.length>0&&(z=F[0].textContent?.trim()||F[0].getAttribute("href")||"");let De=new Date;const $e=m.getElementsByTagName("pubDate"),Ge=m.getElementsByTagName("published"),je=m.getElementsByTagName("date"),ee=$e[0]||Ge[0]||je[0];if(ee?.textContent){const d=new Date(ee.textContent.trim());isNaN(d.getTime())||(De=d)}let b="",U="";const se=m.getElementsByTagName("description"),Xe=m.getElementsByTagName("summary"),Ye=m.getElementsByTagName("content"),Ve=m.getElementsByTagName("content:encoded"),Ke=m.getElementsByTagName("body"),D=se[0]||Xe[0];D?.textContent&&(b=D.textContent);const ie=Ve[0]||Ye[0]||Ke[0]||se[0];ie?.textContent&&(U=ie.textContent),!b&&U&&(b=U),!U&&b&&(U=b);const pe=rn(b).substring(0,500),ge=nn(U);let xe="";const Je=m.getElementsByTagName("author"),qe=m.getElementsByTagName("creator"),Ne=m.getElementsByTagName("dc:creator"),Ie=Je[0]||Ne[0]||qe[0];Ie?.textContent&&(xe=on(Ie.textContent.trim()));const Ee=[],_=m.getElementsByTagName("category");for(let d=0;d<_.length;d++){const E=_[d].textContent?.trim();E&&Ee.push(E)}const V=[];let w="",te="";const T=m.getElementsByTagName("enclosure");for(let d=0;d<T.length;d++){const E=T[d],I=X(E,"type")||"",H=X(E,"url");H&&(I.startsWith("image/")?V.push({url:H,size:parseInt(X(E,"length")||"0"),source:"enclosure",score:10}):I.startsWith("audio/")&&!w&&(w=H))}const Q=d=>{const E=X(d,"url"),I=X(d,"type")||X(d,"medium")||"",H=parseInt(X(d,"width")||"0"),le=parseInt(X(d,"height")||"0");E&&(I.startsWith("image")||I==="image")&&V.push({url:E,width:H,height:le,source:"media:content",score:10+(H>600?5:0)})},ae=m.getElementsByTagName("media:group");for(let d=0;d<ae.length;d++){const E=ae[d].getElementsByTagName("media:content");for(let I=0;I<E.length;I++)Q(E[I])}const K=m.getElementsByTagName("media:content");for(let d=0;d<K.length;d++)Q(K[d]);const ce=m.getElementsByTagName("media:thumbnail");for(let d=0;d<ce.length;d++){const E=X(ce[d],"url"),I=parseInt(X(ce[d],"width")||"0");E&&V.push({url:E,width:I,source:"media:thumbnail",score:5})}const Te=U||b||"",Le=[/<img[^>]+src=["']([^"']+)["'][^>]*>/gi],ve=Te.substring(0,3e3);for(const d of Le){let E;for(;(E=d.exec(ve))!==null&&!(E[1]&&(V.push({url:E[1],source:"html",score:1}),V.length>3)););}if(w&&!te){const d=m.getElementsByTagName("itunes:duration")[0],E=m.getElementsByTagName("duration")[0];d?.textContent?te=d.textContent.trim():E?.textContent&&(te=E.textContent.trim())}const B=qn(V);let ne;if(B)try{const d=new URL(B);(d.protocol==="http:"||d.protocol==="https:")&&!B.includes("?text=")&&!B.match(/^[A-Z0-9]{6}\?text=/i)&&B.includes(".")&&(ne=B)}catch{}k!=="No Title"&&z&&f.push({title:k,link:z,pubDate:De,description:pe,content:ge||void 0,imageUrl:ne,author:xe||void 0,categories:Ee,sourceTitle:s,audioUrl:w||void 0,audioDuration:te||void 0})}catch{oe.warn(`Failed to parse article ${p+1}`,{component:"rssParser"})}}return{title:s,articles:f}}const Qn=[{name:"CorsProxy",url:"https://corsproxy.io",format:n=>`https://corsproxy.io/?${encodeURIComponent(n)}`,parser:Gt},{name:"CodeTabs",url:"https://api.codetabs.com/v1/proxy",format:n=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(n)}`,parser:Gt},{name:"RSS2JSON",url:"https://api.rss2json.com/v1/api.json",format:n=>`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(n)}`,parser:Zn}];function er(n){if(!n||n.trim().length===0)return!1;const e=n.trim();return e.toLowerCase().includes("<!doctype html")||e.toLowerCase().startsWith("<html")?!1:e.startsWith("<")||e.startsWith("{")}async function tr(n,e,t){if(gt.isOpen(n.name))throw new Error(`Circuit breaker open for ${n.name}`);const r=n.format(e);oe.debug(`Trying provider: ${n.name}`,{component:"rssParser",additionalData:{feedUrl:e,proxyUrl:r}});const s=await Jn(r,{signal:t});if(!s.ok)throw s.status===422?new Error(`Provider ${n.name} cannot process this feed (422 Unprocessable Entity)`):new Error(`Provider ${n.name} returned ${s.status}: ${s.statusText}`);const i=await s.text();if(!er(i))throw new Error(`Invalid response from ${n.name}`);const a=n.parser(i,e);if(!a.articles||a.articles.length===0)throw new Error(`No articles parsed from ${n.name}`);return gt.recordSuccess(n.name),oe.info(`Successfully fetched via ${n.name}`,{component:"rssParser",additionalData:{feedUrl:e,provider:n.name,articlesCount:a.articles.length}}),a}async function nr(n,e){const t=_n(n);let r=new Error("Unknown error");for(const s of t)for(const i of Qn)try{return await tr(i,s,e)}catch(a){r=a instanceof Error?a:new Error(String(a)),gt.recordFailure(i.name)}throw new Error(`All providers failed. Last error: ${r.message}`)}function rr(n){return new Promise(e=>setTimeout(e,n))}async function or(n,e={}){const{maxRetries:t=Vn,signal:r}=e;let s=new Error("Unknown error");for(let i=1;i<=t;i++)try{const a=await nr(n,r);return a.articles.length>0&&Tn(n,a.articles,a.title),a}catch(a){if(s=a instanceof Error?a:new Error(String(a)),r?.aborted)throw new Error("Request was cancelled");if(i===t)break;const f=Kn*Math.pow(2,i-1);await rr(f)}throw oe.error(`All ${t} attempts failed`,s,{component:"rssParser",additionalData:{feedUrl:n}}),s}async function gr(n,e={}){const{skipCache:t=!1}=e;if(!t){const r=En(n);if(r&&r.length>0)return oe.debug("Using cached articles",{component:"rssParser",additionalData:{feedUrl:n,cachedCount:r.length}}),{title:r[0].sourceTitle,articles:r}}try{return await or(n,e)}catch(r){return oe.warn("Creating placeholder for failed feed",{component:"rssParser",additionalData:{url:n,error:r instanceof Error?r.message:String(r)}}),{title:"Feed Unavailable",articles:[{title:"RSS Feed Temporarily Unavailable",link:n,pubDate:new Date,description:"Unable to fetch this RSS feed. This may be due to CORS restrictions or temporary server issues. The feed will be retried automatically.",sourceTitle:"System Notice",categories:["system","unavailable"]}]}}}function Er(n){const t=new DOMParser().parseFromString(n,"text/xml"),r=[],s=(a,f)=>{const p=a.getAttribute("xmlUrl"),m=a.getAttribute("text")||a.getAttribute("title");if(p)r.push({url:p,title:m||void 0,category:f});else if(a.children.length>0){const A=m||f;for(let S=0;S<a.children.length;S++){const k=a.children[S];k.tagName.toLowerCase()==="outline"&&s(k,A)}}},i=t.getElementsByTagName("body")[0];if(i)for(let a=0;a<i.children.length;a++){const f=i.children[a];f.tagName.toLowerCase()==="outline"&&s(f)}return r}const g=n=>{const e=n.replace("#","");if(!/^[a-fA-F0-9]{3}$|^[a-fA-F0-9]{6}$/.test(e))throw new Error(`Invalid hex color format: ${n}. Expected format: #RRGGBB or #RGB`);let t,r,s;if(e.length===3?(t=parseInt(e[0]+e[0],16),r=parseInt(e[1]+e[1],16),s=parseInt(e[2]+e[2],16)):(t=parseInt(e.substring(0,2),16),r=parseInt(e.substring(2,4),16),s=parseInt(e.substring(4,6),16)),isNaN(t)||isNaN(r)||isNaN(s)||t<0||t>255||r<0||r>255||s<0||s>255)throw new Error(`Invalid hex color conversion result: ${n} -> ${t} ${r} ${s}`);return`${t} ${r} ${s}`},We=[{id:"dark-blue",name:"Azul Escuro",description:"Tema escuro com tons de azul e contraste otimizado",category:"dark",theme:{id:"dark-blue",name:"Azul Escuro",colors:{primary:"18 102 204",secondary:g("#1E1E1E"),accent:"138 101 8",background:g("#121212"),surface:g("#1E1E1E"),text:g("#FFFFFF"),textSecondary:g("#B0B0B0"),border:"75 85 99",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"dark-green",name:"Verde Escuro",description:"Tema escuro com tons de verde natural",category:"dark",theme:{id:"dark-green",name:"Verde Escuro",colors:{primary:"52 125 54",secondary:g("#1B1F1D"),accent:"122 105 17",background:g("#0D0D0D"),surface:g("#1B1F1D"),text:g("#F1F1F1"),textSecondary:g("#A8A8A8"),border:"75 85 99",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"dark-purple",name:"Roxo Escuro",description:"Tema escuro com tons de roxo e rosa",category:"dark",theme:{id:"dark-purple",name:"Roxo Escuro",colors:{primary:"173 46 207",secondary:g("#1A1A23"),accent:"204 51 102",background:g("#101014"),surface:g("#1A1A23"),text:g("#E0E0E0"),textSecondary:g("#9C9C9C"),border:"75 85 99",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"light-blue",name:"Azul Claro",description:"Tema claro com tons de azul e alto contraste",category:"light",theme:{id:"light-blue",name:"Azul Claro",colors:{primary:g("#1976D2"),secondary:g("#F5F5F5"),accent:"184 61 23",background:g("#FFFFFF"),surface:g("#F5F5F5"),text:g("#212121"),textSecondary:g("#616161"),border:"156 163 175",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"light-pink",name:"Rosa Claro",description:"Tema claro com tons de rosa e lilÃ¡s",category:"light",theme:{id:"light-pink",name:"Rosa Claro",colors:{primary:"178 48 92",secondary:g("#FFFFFF"),accent:g("#7E57C2"),background:g("#FFF8F0"),surface:g("#FFFFFF"),text:g("#212121"),textSecondary:"97 97 97",border:"156 163 175",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"light-cyan",name:"Ciano Claro",description:"Tema claro minimalista com tons frios",category:"light",theme:{id:"light-cyan",name:"Ciano Claro",colors:{primary:"0 129 145",secondary:g("#FFFFFF"),accent:"184 81 49",background:g("#F0F4F8"),surface:g("#FFFFFF"),text:g("#1C1C1C"),textSecondary:g("#5E5E5E"),border:"156 163 175",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}}],Tr={currentTheme:We.find(n=>n.id==="light-blue")?.theme||We[0].theme,customThemes:[],autoDetectSystemTheme:!0,systemThemeOverride:null,themeTransitions:!0},sr=n=>{const e=["id","name","colors","layout","density","borderRadius"],t=["primary","secondary","accent","background","surface","text","textSecondary","border","success","warning","error"];for(const r of e)if(!(r in n))return console.warn(`Theme validation failed: missing field "${r}"`),!1;if(n.colors){for(const r of t)if(!(r in n.colors))return console.warn(`Theme validation failed: missing color "${r}"`),!1}if(n.colors){for(const[r,s]of Object.entries(n.colors))if(!ir(s))return console.warn(`Theme validation failed: invalid RGB format for color "${r}": "${s}"`),!1}return!0},ir=n=>/^\d{1,3}\s+\d{1,3}\s+\d{1,3}$/.test(n)?n.split(/\s+/).map(Number).every(r=>r>=0&&r<=255):!1,yr=(n,e="1.0")=>{try{if(typeof n=="string")return jt(n,"Migrated Theme");if(sr(n))return n;if(n.colors?.accent||n.accent){const t=n.colors?.accent||n.accent;return jt(t,n.name||"Migrated Theme")}return null}catch(t){return console.error("Theme migration failed:",t),null}},jt=(n,e)=>{const t=n.split(/\s+/).map(Number),[r,s,i]=t,a=r*.299+s*.587+i*.114<128;return{id:`custom-${Date.now()}`,name:e,colors:{primary:n,secondary:a?"45 55 72":"229 231 235",accent:n,background:a?"26 32 44":"255 255 255",surface:a?"45 55 72":"249 250 251",text:a?"247 250 252":"17 24 39",textSecondary:a?"160 174 192":"107 114 128",border:a?"75 85 99":"209 213 219",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},Ar=n=>{const e=document.documentElement;Object.entries(n.colors).forEach(([f,p])=>{e.style.setProperty(`--color-${f}`,p)});const r={compact:{padding:"0.5rem",gap:"0.5rem"},comfortable:{padding:"1rem",gap:"1rem"},spacious:{padding:"1.5rem",gap:"1.5rem"}}[n.layout];e.style.setProperty("--layout-padding",r.padding),e.style.setProperty("--layout-gap",r.gap);const i={low:{fontSize:"0.875rem",lineHeight:"1.25rem"},medium:{fontSize:"1rem",lineHeight:"1.5rem"},high:{fontSize:"1.125rem",lineHeight:"1.75rem"}}[n.density];e.style.setProperty("--density-font-size",i.fontSize),e.style.setProperty("--density-line-height",i.lineHeight);const a={none:"0",small:"0.25rem",medium:"0.5rem",large:"1rem"};e.style.setProperty("--border-radius",a[n.borderRadius]),e.style.setProperty("--shadows-enabled",n.shadows?"1":"0"),e.style.setProperty("--animations-enabled",n.animations?"1":"0"),e.style.setProperty("--transition-duration",n.animations?"0.2s":"0s")},Sr=()=>typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"dark",br=n=>{const e=We.filter(t=>t.category===n||n==="dark"&&t.category==="colorful");return e.length>0?e[0].theme:We[0].theme};function wr(n){const e={articles:new Map,titleIndex:new Map,contentIndex:new Map,categoryIndex:new Map,sourceIndex:new Map,lastUpdated:Date.now()};return n.forEach((t,r)=>{const s=`${t.link}-${r}`;e.articles.set(s,t),Re(t.title).forEach(f=>{e.titleIndex.has(f)||e.titleIndex.set(f,[]),e.titleIndex.get(f).push(s)}),t.description&&Re(t.description).forEach(p=>{e.contentIndex.has(p)||e.contentIndex.set(p,[]),e.contentIndex.get(p).push(s)}),t.categories&&t.categories.forEach(f=>{Re(f).forEach(m=>{e.categoryIndex.has(m)||e.categoryIndex.set(m,[]),e.categoryIndex.get(m).push(s)})}),Re(t.sourceTitle).forEach(f=>{e.sourceIndex.has(f)||e.sourceIndex.set(f,[]),e.sourceIndex.get(f).push(s)})}),e}function Re(n){return n.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(e=>e.length>2)}function _r(n,e,t={}){const{includeTitle:r=!0,includeContent:s=!0,includeCategories:i=!0,includeSource:a=!0,fuzzyThreshold:f=.6}=t;if(!e.trim())return[];const p=Re(e),m=new Map;p.forEach(S=>{r&&Be(n.titleIndex,S,f,m,"title",3),s&&Be(n.contentIndex,S,f,m,"content",1),i&&Be(n.categoryIndex,S,f,m,"category",2),a&&Be(n.sourceIndex,S,f,m,"source",1.5)});const A=[];return m.forEach((S,k)=>{const z=n.articles.get(k);z&&A.push({article:z,score:S.score,matchedFields:Array.from(S.matchedFields)})}),A.sort((S,k)=>k.score-S.score)}function Be(n,e,t,r,s,i){n.forEach((a,f)=>{const p=ar(e,f);if(p>=t){const m=p*i;a.forEach(A=>{r.has(A)||r.set(A,{score:0,matchedFields:new Set});const S=r.get(A);S.score+=m,S.matchedFields.add(s)})}})}function ar(n,e){if(n===e)return 1;if(n.includes(e)||e.includes(n))return .9;const t=Math.max(n.length,e.length);return t===0?1:1-cr(n,e)/t}function cr(n,e){const t=Array(e.length+1).fill(null).map(()=>Array(n.length+1).fill(null));for(let r=0;r<=n.length;r++)t[0][r]=r;for(let r=0;r<=e.length;r++)t[r][0]=r;for(let r=1;r<=e.length;r++)for(let s=1;s<=n.length;s++){const i=n[s-1]===e[r-1]?0:1;t[r][s]=Math.min(t[r][s-1]+1,t[r-1][s]+1,t[r-1][s-1]+i)}return t[e.length][n.length]}function Cr(n,e){if(!e.trim())return n;const t=e.trim().split(/\s+/);let r=n;return t.forEach(s=>{const i=lr(s),a=new RegExp(`(${i})`,"gi");r=r.replace(a,"<mark>$1</mark>")}),r}function lr(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const Xt={log:n=>{}},ur={maxSize:500,maxAge:1440*60*1e3,memoryLimit:50,autoCleanupInterval:300*1e3};class mr{constructor(e={}){this.options={...ur,...e},this.cache=new Map,this.stats={hits:0,misses:0,evictions:0},this.cleanupInterval=null,this.options.autoCleanupInterval>0&&this.startAutoCleanup()}getKey(e){return`${e.link}|${e.sourceTitle}`}get(e,t){let r;if(typeof e=="string"&&t)r=`${e}|${t}`;else if(typeof e=="object")r=this.getKey(e);else throw new Error("Invalid arguments to get()");const s=this.cache.get(r);return s?(this.cache.delete(r),this.cache.set(r,{article:s.article,timestamp:s.timestamp}),this.stats.hits++,s.article):(this.stats.misses++,null)}set(e){const t=this.getKey(e);this.cache.delete(t),this.cache.set(t,{article:e,timestamp:Date.now()}),this.enforceConstraints()}setMany(e){e.forEach(t=>this.set(t))}has(e,t){let r;if(typeof e=="string"&&t)r=`${e}|${t}`;else if(typeof e=="object")r=this.getKey(e);else throw new Error("Invalid arguments to has()");return this.cache.has(r)}delete(e,t){let r;if(typeof e=="string"&&t)r=`${e}|${t}`;else if(typeof e=="object")r=this.getKey(e);else throw new Error("Invalid arguments to delete()");return this.cache.delete(r)}clear(){this.cache.clear()}size(){return this.cache.size}getAll(){return Array.from(this.cache.values()).map(e=>e.article)}getStats(){const e=Date.now();let t=0,r=e,s=0;this.cache.forEach(({timestamp:A})=>{t+=e-A,A<r&&(r=A),A>s&&(s=A)});const i=this.cache.size,a=i>0?t/i:0,f=i>0?e-r:0,p=i>0?e-s:0;let m=null;return"memory"in performance&&(m=Math.round(performance.memory.usedJSHeapSize/(1024*1024))),{hits:this.stats.hits,misses:this.stats.misses,hitRate:this.stats.hits+this.stats.misses>0?this.stats.hits/(this.stats.hits+this.stats.misses):0,size:i,maxSize:this.options.maxSize,evictions:this.stats.evictions,oldestItemAge:f,newestItemAge:p,averageAge:a,memoryUsage:m}}enforceConstraints(){this.enforceMaxSize(),this.enforceMaxAge(),this.enforceMemoryLimit()}enforceMaxSize(){if(this.cache.size<=this.options.maxSize)return;const e=this.cache.size-this.options.maxSize;if(e<=0)return;const t=Array.from(this.cache.entries()).sort((r,s)=>r[1].timestamp-s[1].timestamp);for(let r=0;r<e;r++)r<t.length&&(this.cache.delete(t[r][0]),this.stats.evictions++)}enforceMaxAge(){if(this.options.maxAge<=0)return;const e=Date.now();this.cache.forEach((t,r)=>{e-t.timestamp>this.options.maxAge&&(this.cache.delete(r),this.stats.evictions++)})}enforceMemoryLimit(){if(this.options.memoryLimit<=0||!("memory"in performance))return;const t=performance.memory.usedJSHeapSize/(1024*1024);if(t<this.options.memoryLimit)return;const r=Math.max(1,Math.ceil(this.cache.size*.1)),s=Array.from(this.cache.entries()).sort((i,a)=>i[1].timestamp-a[1].timestamp);for(let i=0;i<r&&i<s.length;i++)this.cache.delete(s[i][0]),this.stats.evictions++;Xt.log(`Evicted ${r} articles from cache due to memory limit (${t.toFixed(2)}MB used)`)}startAutoCleanup(){this.cleanupInterval===null&&(this.cleanupInterval=window.setInterval(()=>{this.cleanup()},this.options.autoCleanupInterval),Xt.log(`Started automatic cache cleanup every ${this.options.autoCleanupInterval/1e3} seconds`))}stopAutoCleanup(){this.cleanupInterval!==null&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}cleanup(){this.cache.size,this.enforceMaxAge(),this.enforceMemoryLimit(),this.cache.size}resetStats(){this.stats={hits:0,misses:0,evictions:0}}}const Rr=new mr;export{Rr as a,Sr as b,br as c,Ar as d,We as e,Tr as f,En as g,wr as h,dr as i,Xn as j,Cr as k,tn as l,yr as m,Er as n,pr as o,gr as p,hr as q,_r as s,fr as u,sr as v};
