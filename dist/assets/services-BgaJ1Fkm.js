function pr(n){const e={articles:new Map,titleIndex:new Map,contentIndex:new Map,categoryIndex:new Map,sourceIndex:new Map,lastUpdated:Date.now()};return n.forEach((t,r)=>{const s=`${t.link}-${r}`;e.articles.set(s,t),Ae(t.title).forEach(d=>{e.titleIndex.has(d)||e.titleIndex.set(d,[]),e.titleIndex.get(d).push(s)}),t.description&&Ae(t.description).forEach(h=>{e.contentIndex.has(h)||e.contentIndex.set(h,[]),e.contentIndex.get(h).push(s)}),t.categories&&t.categories.forEach(d=>{Ae(d).forEach(m=>{e.categoryIndex.has(m)||e.categoryIndex.set(m,[]),e.categoryIndex.get(m).push(s)})}),Ae(t.sourceTitle).forEach(d=>{e.sourceIndex.has(d)||e.sourceIndex.set(d,[]),e.sourceIndex.get(d).push(s)})}),e}function Ae(n){return n.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(e=>e.length>2)}function gr(n,e,t={}){const{includeTitle:r=!0,includeContent:s=!0,includeCategories:i=!0,includeSource:c=!0,fuzzyThreshold:d=.6}=t;if(!e.trim())return[];const h=Ae(e),m=new Map;h.forEach(S=>{r&&Oe(n.titleIndex,S,d,m,"title",3),s&&Oe(n.contentIndex,S,d,m,"content",1),i&&Oe(n.categoryIndex,S,d,m,"category",2),c&&Oe(n.sourceIndex,S,d,m,"source",1.5)});const E=[];return m.forEach((S,B)=>{const $=n.articles.get(B);$&&E.push({article:$,score:S.score,matchedFields:Array.from(S.matchedFields)})}),E.sort((S,B)=>B.score-S.score)}function Oe(n,e,t,r,s,i){n.forEach((c,d)=>{const h=gn(e,d);if(h>=t){const m=h*i;c.forEach(E=>{r.has(E)||r.set(E,{score:0,matchedFields:new Set});const S=r.get(E);S.score+=m,S.matchedFields.add(s)})}})}function gn(n,e){if(n===e)return 1;if(n.includes(e)||e.includes(n))return .9;const t=Math.max(n.length,e.length);return t===0?1:1-En(n,e)/t}function En(n,e){const t=Array(e.length+1).fill(null).map(()=>Array(n.length+1).fill(null));for(let r=0;r<=n.length;r++)t[0][r]=r;for(let r=0;r<=e.length;r++)t[r][0]=r;for(let r=1;r<=e.length;r++)for(let s=1;s<=n.length;s++){const i=n[s-1]===e[r-1]?0:1;t[r][s]=Math.min(t[r][s-1]+1,t[r-1][s]+1,t[r-1][s-1]+i)}return t[e.length][n.length]}function Er(n,e){if(!e.trim())return n;const t=e.trim().split(/\s+/);let r=n;return t.forEach(s=>{const i=Tn(s),c=new RegExp(`(${i})`,"gi");r=r.replace(c,"<mark>$1</mark>")}),r}function Tn(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const{entries:Vt,setPrototypeOf:Ut,isFrozen:yn,getPrototypeOf:bn,getOwnPropertyDescriptor:An}=Object;let{freeze:O,seal:z,create:mt}=Object,{apply:dt,construct:ft}=typeof Reflect<"u"&&Reflect;O||(O=function(e){return e});z||(z=function(e){return e});dt||(dt=function(e,t){for(var r=arguments.length,s=new Array(r>2?r-2:0),i=2;i<r;i++)s[i-2]=arguments[i];return e.apply(t,s)});ft||(ft=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return new e(...r)});const Fe=F(Array.prototype.forEach),Sn=F(Array.prototype.lastIndexOf),zt=F(Array.prototype.pop),ge=F(Array.prototype.push),wn=F(Array.prototype.splice),ke=F(String.prototype.toLowerCase),rt=F(String.prototype.toString),ot=F(String.prototype.match),Ee=F(String.prototype.replace),_n=F(String.prototype.indexOf),Cn=F(String.prototype.trim),W=F(Object.prototype.hasOwnProperty),N=F(RegExp.prototype.test),Te=xn(TypeError);function F(n){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return dt(n,e,r)}}function xn(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return ft(n,t)}}function f(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ke;Ut&&Ut(n,null);let r=e.length;for(;r--;){let s=e[r];if(typeof s=="string"){const i=t(s);i!==s&&(yn(e)||(e[r]=i),s=i)}n[s]=!0}return n}function Rn(n){for(let e=0;e<n.length;e++)W(n,e)||(n[e]=null);return n}function K(n){const e=mt(null);for(const[t,r]of Vt(n))W(n,t)&&(Array.isArray(r)?e[t]=Rn(r):r&&typeof r=="object"&&r.constructor===Object?e[t]=K(r):e[t]=r);return e}function ye(n,e){for(;n!==null;){const r=An(n,e);if(r){if(r.get)return F(r.get);if(typeof r.value=="function")return F(r.value)}n=bn(n)}function t(){return null}return t}const Bt=O(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),st=O(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),it=O(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Dn=O(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),at=O(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),vn=O(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),$t=O(["#text"]),Wt=O(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),ct=O(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ht=O(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Pe=O(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Ln=z(/\{\{[\w\W]*|[\w\W]*\}\}/gm),In=z(/<%[\w\W]*|[\w\W]*%>/gm),Nn=z(/\$\{[\w\W]*/gm),Mn=z(/^data-[\-\w.\u00B7-\uFFFF]+$/),On=z(/^aria-[\-\w]+$/),Kt=z(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Fn=z(/^(?:\w+script|data):/i),Pn=z(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),qt=z(/^html$/i),kn=z(/^[a-z][.\w]*(-[.\w]+)+$/i);var Gt=Object.freeze({__proto__:null,ARIA_ATTR:On,ATTR_WHITESPACE:Pn,CUSTOM_ELEMENT:kn,DATA_ATTR:Mn,DOCTYPE_NAME:qt,ERB_EXPR:In,IS_ALLOWED_URI:Kt,IS_SCRIPT_OR_DATA:Fn,MUSTACHE_EXPR:Ln,TMPLIT_EXPR:Nn});const be={element:1,text:3,progressingInstruction:7,comment:8,document:9},Un=function(){return typeof window>"u"?null:window},zn=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const s="data-tt-policy-suffix";t&&t.hasAttribute(s)&&(r=t.getAttribute(s));const i="dompurify"+(r?"#"+r:"");try{return e.createPolicy(i,{createHTML(c){return c},createScriptURL(c){return c}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}},jt=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Jt(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Un();const e=u=>Jt(u);if(e.version="3.3.0",e.removed=[],!n||!n.document||n.document.nodeType!==be.document||!n.Element)return e.isSupported=!1,e;let{document:t}=n;const r=t,s=r.currentScript,{DocumentFragment:i,HTMLTemplateElement:c,Node:d,Element:h,NodeFilter:m,NamedNodeMap:E=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:S,DOMParser:B,trustedTypes:$}=n,j=h.prototype,Se=ye(j,"cloneNode"),ze=ye(j,"remove"),Be=ye(j,"nextSibling"),$e=ye(j,"childNodes"),J=ye(j,"parentNode");if(typeof c=="function"){const u=t.createElement("template");u.content&&u.content.ownerDocument&&(t=u.content.ownerDocument)}let b,k="";const{implementation:ee,createNodeIterator:We,createDocumentFragment:He,getElementsByTagName:Ge}=t,{importNode:je}=r;let x=jt();e.isSupported=typeof Vt=="function"&&typeof J=="function"&&ee&&ee.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:te,ERB_EXPR:me,TMPLIT_EXPR:de,DATA_ATTR:we,ARIA_ATTR:Xe,IS_SCRIPT_OR_DATA:Ye,ATTR_WHITESPACE:_e,CUSTOM_ELEMENT:Ce}=Gt;let{IS_ALLOWED_URI:fe}=Gt,w=null;const R=f({},[...Bt,...st,...it,...at,...$t]);let A=null;const ne=f({},[...Wt,...ct,...Ht,...Pe]);let T=Object.seal(mt(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),q=null,g=null;const _=Object.seal(mt(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let I=!0,U=!0,xe=!1,yt=!0,re=!1,Re=!0,Z=!1,Ve=!1,Ke=!1,oe=!1,De=!1,ve=!1,bt=!0,At=!1;const cn="user-content-";let qe=!0,he=!1,se={},ie=null;const St=f({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let wt=null;const _t=f({},["audio","video","img","source","image","track"]);let Je=null;const Ct=f({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Le="http://www.w3.org/1998/Math/MathML",Ie="http://www.w3.org/2000/svg",X="http://www.w3.org/1999/xhtml";let ae=X,Ze=!1,Qe=null;const ln=f({},[Le,Ie,X],rt);let Ne=f({},["mi","mo","mn","ms","mtext"]),Me=f({},["annotation-xml"]);const un=f({},["title","style","font","a","script"]);let pe=null;const mn=["application/xhtml+xml","text/html"],dn="text/html";let D=null,ce=null;const fn=t.createElement("form"),xt=function(o){return o instanceof RegExp||o instanceof Function},et=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(ce&&ce===o)){if((!o||typeof o!="object")&&(o={}),o=K(o),pe=mn.indexOf(o.PARSER_MEDIA_TYPE)===-1?dn:o.PARSER_MEDIA_TYPE,D=pe==="application/xhtml+xml"?rt:ke,w=W(o,"ALLOWED_TAGS")?f({},o.ALLOWED_TAGS,D):R,A=W(o,"ALLOWED_ATTR")?f({},o.ALLOWED_ATTR,D):ne,Qe=W(o,"ALLOWED_NAMESPACES")?f({},o.ALLOWED_NAMESPACES,rt):ln,Je=W(o,"ADD_URI_SAFE_ATTR")?f(K(Ct),o.ADD_URI_SAFE_ATTR,D):Ct,wt=W(o,"ADD_DATA_URI_TAGS")?f(K(_t),o.ADD_DATA_URI_TAGS,D):_t,ie=W(o,"FORBID_CONTENTS")?f({},o.FORBID_CONTENTS,D):St,q=W(o,"FORBID_TAGS")?f({},o.FORBID_TAGS,D):K({}),g=W(o,"FORBID_ATTR")?f({},o.FORBID_ATTR,D):K({}),se=W(o,"USE_PROFILES")?o.USE_PROFILES:!1,I=o.ALLOW_ARIA_ATTR!==!1,U=o.ALLOW_DATA_ATTR!==!1,xe=o.ALLOW_UNKNOWN_PROTOCOLS||!1,yt=o.ALLOW_SELF_CLOSE_IN_ATTR!==!1,re=o.SAFE_FOR_TEMPLATES||!1,Re=o.SAFE_FOR_XML!==!1,Z=o.WHOLE_DOCUMENT||!1,oe=o.RETURN_DOM||!1,De=o.RETURN_DOM_FRAGMENT||!1,ve=o.RETURN_TRUSTED_TYPE||!1,Ke=o.FORCE_BODY||!1,bt=o.SANITIZE_DOM!==!1,At=o.SANITIZE_NAMED_PROPS||!1,qe=o.KEEP_CONTENT!==!1,he=o.IN_PLACE||!1,fe=o.ALLOWED_URI_REGEXP||Kt,ae=o.NAMESPACE||X,Ne=o.MATHML_TEXT_INTEGRATION_POINTS||Ne,Me=o.HTML_INTEGRATION_POINTS||Me,T=o.CUSTOM_ELEMENT_HANDLING||{},o.CUSTOM_ELEMENT_HANDLING&&xt(o.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(T.tagNameCheck=o.CUSTOM_ELEMENT_HANDLING.tagNameCheck),o.CUSTOM_ELEMENT_HANDLING&&xt(o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(T.attributeNameCheck=o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),o.CUSTOM_ELEMENT_HANDLING&&typeof o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(T.allowCustomizedBuiltInElements=o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),re&&(U=!1),De&&(oe=!0),se&&(w=f({},$t),A=[],se.html===!0&&(f(w,Bt),f(A,Wt)),se.svg===!0&&(f(w,st),f(A,ct),f(A,Pe)),se.svgFilters===!0&&(f(w,it),f(A,ct),f(A,Pe)),se.mathMl===!0&&(f(w,at),f(A,Ht),f(A,Pe))),o.ADD_TAGS&&(typeof o.ADD_TAGS=="function"?_.tagCheck=o.ADD_TAGS:(w===R&&(w=K(w)),f(w,o.ADD_TAGS,D))),o.ADD_ATTR&&(typeof o.ADD_ATTR=="function"?_.attributeCheck=o.ADD_ATTR:(A===ne&&(A=K(A)),f(A,o.ADD_ATTR,D))),o.ADD_URI_SAFE_ATTR&&f(Je,o.ADD_URI_SAFE_ATTR,D),o.FORBID_CONTENTS&&(ie===St&&(ie=K(ie)),f(ie,o.FORBID_CONTENTS,D)),qe&&(w["#text"]=!0),Z&&f(w,["html","head","body"]),w.table&&(f(w,["tbody"]),delete q.tbody),o.TRUSTED_TYPES_POLICY){if(typeof o.TRUSTED_TYPES_POLICY.createHTML!="function")throw Te('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof o.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Te('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');b=o.TRUSTED_TYPES_POLICY,k=b.createHTML("")}else b===void 0&&(b=zn($,s)),b!==null&&typeof k=="string"&&(k=b.createHTML(""));O&&O(o),ce=o}},Rt=f({},[...st,...it,...Dn]),Dt=f({},[...at,...vn]),hn=function(o){let a=J(o);(!a||!a.tagName)&&(a={namespaceURI:ae,tagName:"template"});const l=ke(o.tagName),y=ke(a.tagName);return Qe[o.namespaceURI]?o.namespaceURI===Ie?a.namespaceURI===X?l==="svg":a.namespaceURI===Le?l==="svg"&&(y==="annotation-xml"||Ne[y]):!!Rt[l]:o.namespaceURI===Le?a.namespaceURI===X?l==="math":a.namespaceURI===Ie?l==="math"&&Me[y]:!!Dt[l]:o.namespaceURI===X?a.namespaceURI===Ie&&!Me[y]||a.namespaceURI===Le&&!Ne[y]?!1:!Dt[l]&&(un[l]||!Rt[l]):!!(pe==="application/xhtml+xml"&&Qe[o.namespaceURI]):!1},G=function(o){ge(e.removed,{element:o});try{J(o).removeChild(o)}catch{ze(o)}},Q=function(o,a){try{ge(e.removed,{attribute:a.getAttributeNode(o),from:a})}catch{ge(e.removed,{attribute:null,from:a})}if(a.removeAttribute(o),o==="is")if(oe||De)try{G(a)}catch{}else try{a.setAttribute(o,"")}catch{}},vt=function(o){let a=null,l=null;if(Ke)o="<remove></remove>"+o;else{const C=ot(o,/^[\r\n\t ]+/);l=C&&C[0]}pe==="application/xhtml+xml"&&ae===X&&(o='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+o+"</body></html>");const y=b?b.createHTML(o):o;if(ae===X)try{a=new B().parseFromString(y,pe)}catch{}if(!a||!a.documentElement){a=ee.createDocument(ae,"template",null);try{a.documentElement.innerHTML=Ze?k:y}catch{}}const L=a.body||a.documentElement;return o&&l&&L.insertBefore(t.createTextNode(l),L.childNodes[0]||null),ae===X?Ge.call(a,Z?"html":"body")[0]:Z?a.documentElement:L},Lt=function(o){return We.call(o.ownerDocument||o,o,m.SHOW_ELEMENT|m.SHOW_COMMENT|m.SHOW_TEXT|m.SHOW_PROCESSING_INSTRUCTION|m.SHOW_CDATA_SECTION,null)},tt=function(o){return o instanceof S&&(typeof o.nodeName!="string"||typeof o.textContent!="string"||typeof o.removeChild!="function"||!(o.attributes instanceof E)||typeof o.removeAttribute!="function"||typeof o.setAttribute!="function"||typeof o.namespaceURI!="string"||typeof o.insertBefore!="function"||typeof o.hasChildNodes!="function")},It=function(o){return typeof d=="function"&&o instanceof d};function Y(u,o,a){Fe(u,l=>{l.call(e,o,a,ce)})}const Nt=function(o){let a=null;if(Y(x.beforeSanitizeElements,o,null),tt(o))return G(o),!0;const l=D(o.nodeName);if(Y(x.uponSanitizeElement,o,{tagName:l,allowedTags:w}),Re&&o.hasChildNodes()&&!It(o.firstElementChild)&&N(/<[/\w!]/g,o.innerHTML)&&N(/<[/\w!]/g,o.textContent)||o.nodeType===be.progressingInstruction||Re&&o.nodeType===be.comment&&N(/<[/\w]/g,o.data))return G(o),!0;if(!(_.tagCheck instanceof Function&&_.tagCheck(l))&&(!w[l]||q[l])){if(!q[l]&&Ot(l)&&(T.tagNameCheck instanceof RegExp&&N(T.tagNameCheck,l)||T.tagNameCheck instanceof Function&&T.tagNameCheck(l)))return!1;if(qe&&!ie[l]){const y=J(o)||o.parentNode,L=$e(o)||o.childNodes;if(L&&y){const C=L.length;for(let P=C-1;P>=0;--P){const V=Se(L[P],!0);V.__removalCount=(o.__removalCount||0)+1,y.insertBefore(V,Be(o))}}}return G(o),!0}return o instanceof h&&!hn(o)||(l==="noscript"||l==="noembed"||l==="noframes")&&N(/<\/no(script|embed|frames)/i,o.innerHTML)?(G(o),!0):(re&&o.nodeType===be.text&&(a=o.textContent,Fe([te,me,de],y=>{a=Ee(a,y," ")}),o.textContent!==a&&(ge(e.removed,{element:o.cloneNode()}),o.textContent=a)),Y(x.afterSanitizeElements,o,null),!1)},Mt=function(o,a,l){if(bt&&(a==="id"||a==="name")&&(l in t||l in fn))return!1;if(!(U&&!g[a]&&N(we,a))){if(!(I&&N(Xe,a))){if(!(_.attributeCheck instanceof Function&&_.attributeCheck(a,o))){if(!A[a]||g[a]){if(!(Ot(o)&&(T.tagNameCheck instanceof RegExp&&N(T.tagNameCheck,o)||T.tagNameCheck instanceof Function&&T.tagNameCheck(o))&&(T.attributeNameCheck instanceof RegExp&&N(T.attributeNameCheck,a)||T.attributeNameCheck instanceof Function&&T.attributeNameCheck(a,o))||a==="is"&&T.allowCustomizedBuiltInElements&&(T.tagNameCheck instanceof RegExp&&N(T.tagNameCheck,l)||T.tagNameCheck instanceof Function&&T.tagNameCheck(l))))return!1}else if(!Je[a]){if(!N(fe,Ee(l,_e,""))){if(!((a==="src"||a==="xlink:href"||a==="href")&&o!=="script"&&_n(l,"data:")===0&&wt[o])){if(!(xe&&!N(Ye,Ee(l,_e,"")))){if(l)return!1}}}}}}}return!0},Ot=function(o){return o!=="annotation-xml"&&ot(o,Ce)},Ft=function(o){Y(x.beforeSanitizeAttributes,o,null);const{attributes:a}=o;if(!a||tt(o))return;const l={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:A,forceKeepAttr:void 0};let y=a.length;for(;y--;){const L=a[y],{name:C,namespaceURI:P,value:V}=L,le=D(C),nt=V;let v=C==="value"?nt:Cn(nt);if(l.attrName=le,l.attrValue=v,l.keepAttr=!0,l.forceKeepAttr=void 0,Y(x.uponSanitizeAttribute,o,l),v=l.attrValue,At&&(le==="id"||le==="name")&&(Q(C,o),v=cn+v),Re&&N(/((--!?|])>)|<\/(style|title|textarea)/i,v)){Q(C,o);continue}if(le==="attributename"&&ot(v,"href")){Q(C,o);continue}if(l.forceKeepAttr)continue;if(!l.keepAttr){Q(C,o);continue}if(!yt&&N(/\/>/i,v)){Q(C,o);continue}re&&Fe([te,me,de],kt=>{v=Ee(v,kt," ")});const Pt=D(o.nodeName);if(!Mt(Pt,le,v)){Q(C,o);continue}if(b&&typeof $=="object"&&typeof $.getAttributeType=="function"&&!P)switch($.getAttributeType(Pt,le)){case"TrustedHTML":{v=b.createHTML(v);break}case"TrustedScriptURL":{v=b.createScriptURL(v);break}}if(v!==nt)try{P?o.setAttributeNS(P,C,v):o.setAttribute(C,v),tt(o)?G(o):zt(e.removed)}catch{Q(C,o)}}Y(x.afterSanitizeAttributes,o,null)},pn=function u(o){let a=null;const l=Lt(o);for(Y(x.beforeSanitizeShadowDOM,o,null);a=l.nextNode();)Y(x.uponSanitizeShadowNode,a,null),Nt(a),Ft(a),a.content instanceof i&&u(a.content);Y(x.afterSanitizeShadowDOM,o,null)};return e.sanitize=function(u){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=null,l=null,y=null,L=null;if(Ze=!u,Ze&&(u="<!-->"),typeof u!="string"&&!It(u))if(typeof u.toString=="function"){if(u=u.toString(),typeof u!="string")throw Te("dirty is not a string, aborting")}else throw Te("toString is not a function");if(!e.isSupported)return u;if(Ve||et(o),e.removed=[],typeof u=="string"&&(he=!1),he){if(u.nodeName){const V=D(u.nodeName);if(!w[V]||q[V])throw Te("root node is forbidden and cannot be sanitized in-place")}}else if(u instanceof d)a=vt("<!---->"),l=a.ownerDocument.importNode(u,!0),l.nodeType===be.element&&l.nodeName==="BODY"||l.nodeName==="HTML"?a=l:a.appendChild(l);else{if(!oe&&!re&&!Z&&u.indexOf("<")===-1)return b&&ve?b.createHTML(u):u;if(a=vt(u),!a)return oe?null:ve?k:""}a&&Ke&&G(a.firstChild);const C=Lt(he?u:a);for(;y=C.nextNode();)Nt(y),Ft(y),y.content instanceof i&&pn(y.content);if(he)return u;if(oe){if(De)for(L=He.call(a.ownerDocument);a.firstChild;)L.appendChild(a.firstChild);else L=a;return(A.shadowroot||A.shadowrootmode)&&(L=je.call(r,L,!0)),L}let P=Z?a.outerHTML:a.innerHTML;return Z&&w["!doctype"]&&a.ownerDocument&&a.ownerDocument.doctype&&a.ownerDocument.doctype.name&&N(qt,a.ownerDocument.doctype.name)&&(P="<!DOCTYPE "+a.ownerDocument.doctype.name+`>
`+P),re&&Fe([te,me,de],V=>{P=Ee(P,V," ")}),b&&ve?b.createHTML(P):P},e.setConfig=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};et(u),Ve=!0},e.clearConfig=function(){ce=null,Ve=!1},e.isValidAttribute=function(u,o,a){ce||et({});const l=D(u),y=D(o);return Mt(l,y,a)},e.addHook=function(u,o){typeof o=="function"&&ge(x[u],o)},e.removeHook=function(u,o){if(o!==void 0){const a=Sn(x[u],o);return a===-1?void 0:wn(x[u],a,1)[0]}return zt(x[u])},e.removeHooks=function(u){x[u]=[]},e.removeAllHooks=function(){x=jt()},e}var Zt=Jt();const Tr=Object.freeze(Object.defineProperty({__proto__:null,default:Zt},Symbol.toStringTag,{value:"Module"})),pt=Zt(typeof window<"u"?window:void 0);pt.addHook("afterSanitizeAttributes",function(n){"target"in n&&n.tagName==="A"&&(n.setAttribute("target","_blank"),n.setAttribute("rel","noopener noreferrer"))});function Qt(n){return n?pt.sanitize(n,{ALLOWED_TAGS:["p","br","b","i","em","strong","u","a","img","h1","h2","h3","h4","h5","h6","ul","ol","li","blockquote","code","pre","span","div","table","thead","tbody","tr","td","th"],ALLOWED_ATTR:["href","src","alt","title","class","target","rel","width","height"],FORBID_TAGS:["script","style","iframe","object","embed","form","input","button"]}):""}function Bn(n){if(!n)return"";const e=pt.sanitize(n,{ALLOWED_TAGS:[],KEEP_CONTENT:!0});if(typeof document<"u"){const r=document.createElement("textarea");return r.innerHTML=e,r.value}let t=n;for(let r=0;r<5;r++){const s=t;if(t=t.replace(/&amp;/g,"&"),t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&apos;/g,"'").replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/").replace(/&#(\d+);/g,(i,c)=>String.fromCharCode(parseInt(c,10))).replace(/&#x([0-9a-f]+);/gi,(i,c)=>String.fromCharCode(parseInt(c,16))),t=t.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/on\w+\s*=\s*["'][^"']*["']/gi,"").replace(/javascript:/gi,"").replace(/vbscript:/gi,"").replace(/data:text\/html/gi,"").replace(/<[^>]*>/g,"").replace(/<[^<]*$/g,""),t===s)break}return t=t.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"").trim(),t}function yr(n,e=300){const t=Bn(n);if(t.length<=e)return t;const r=t.substring(0,e),s=r.lastIndexOf(" ");return s>e*.8?r.substring(0,s)+"...":r+"..."}const p=n=>{const e=n.replace("#","");if(!/^[a-fA-F0-9]{3}$|^[a-fA-F0-9]{6}$/.test(e))throw new Error(`Invalid hex color format: ${n}. Expected format: #RRGGBB or #RGB`);let t,r,s;if(e.length===3?(t=parseInt(e[0]+e[0],16),r=parseInt(e[1]+e[1],16),s=parseInt(e[2]+e[2],16)):(t=parseInt(e.substring(0,2),16),r=parseInt(e.substring(2,4),16),s=parseInt(e.substring(4,6),16)),isNaN(t)||isNaN(r)||isNaN(s)||t<0||t>255||r<0||r>255||s<0||s>255)throw new Error(`Invalid hex color conversion result: ${n} -> ${t} ${r} ${s}`);return`${t} ${r} ${s}`},Ue=[{id:"dark-blue",name:"Azul Escuro",description:"Tema escuro com tons de azul e contraste otimizado",category:"dark",theme:{id:"dark-blue",name:"Azul Escuro",colors:{primary:"18 102 204",secondary:p("#1E1E1E"),accent:"138 101 8",background:p("#121212"),surface:p("#1E1E1E"),text:p("#FFFFFF"),textSecondary:p("#B0B0B0"),border:"75 85 99",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"dark-green",name:"Verde Escuro",description:"Tema escuro com tons de verde natural",category:"dark",theme:{id:"dark-green",name:"Verde Escuro",colors:{primary:"52 125 54",secondary:p("#1B1F1D"),accent:"122 105 17",background:p("#0D0D0D"),surface:p("#1B1F1D"),text:p("#F1F1F1"),textSecondary:p("#A8A8A8"),border:"75 85 99",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"dark-purple",name:"Roxo Escuro",description:"Tema escuro com tons de roxo e rosa",category:"dark",theme:{id:"dark-purple",name:"Roxo Escuro",colors:{primary:"173 46 207",secondary:p("#1A1A23"),accent:"204 51 102",background:p("#101014"),surface:p("#1A1A23"),text:p("#E0E0E0"),textSecondary:p("#9C9C9C"),border:"75 85 99",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"light-blue",name:"Azul Claro",description:"Tema claro com tons de azul e alto contraste",category:"light",theme:{id:"light-blue",name:"Azul Claro",colors:{primary:p("#1976D2"),secondary:p("#F5F5F5"),accent:"184 61 23",background:p("#FFFFFF"),surface:p("#F5F5F5"),text:p("#212121"),textSecondary:p("#616161"),border:"156 163 175",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"light-pink",name:"Rosa Claro",description:"Tema claro com tons de rosa e lilÃ¡s",category:"light",theme:{id:"light-pink",name:"Rosa Claro",colors:{primary:"178 48 92",secondary:p("#FFFFFF"),accent:p("#7E57C2"),background:p("#FFF8F0"),surface:p("#FFFFFF"),text:p("#212121"),textSecondary:"97 97 97",border:"156 163 175",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"light-cyan",name:"Ciano Claro",description:"Tema claro minimalista com tons frios",category:"light",theme:{id:"light-cyan",name:"Ciano Claro",colors:{primary:"0 129 145",secondary:p("#FFFFFF"),accent:"184 81 49",background:p("#F0F4F8"),surface:p("#FFFFFF"),text:p("#1C1C1C"),textSecondary:p("#5E5E5E"),border:"156 163 175",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}}],br={currentTheme:Ue.find(n=>n.id==="light-blue")?.theme||Ue[0].theme,customThemes:[],autoDetectSystemTheme:!0,systemThemeOverride:null,themeTransitions:!0},$n=n=>{const e=["id","name","colors","layout","density","borderRadius"],t=["primary","secondary","accent","background","surface","text","textSecondary","border","success","warning","error"];for(const r of e)if(!(r in n))return console.warn(`Theme validation failed: missing field "${r}"`),!1;if(n.colors){for(const r of t)if(!(r in n.colors))return console.warn(`Theme validation failed: missing color "${r}"`),!1}if(n.colors){for(const[r,s]of Object.entries(n.colors))if(!Wn(s))return console.warn(`Theme validation failed: invalid RGB format for color "${r}": "${s}"`),!1}return!0},Wn=n=>/^\d{1,3}\s+\d{1,3}\s+\d{1,3}$/.test(n)?n.split(/\s+/).map(Number).every(r=>r>=0&&r<=255):!1,Ar=(n,e="1.0")=>{try{if(typeof n=="string")return Xt(n,"Migrated Theme");if($n(n))return n;if(n.colors?.accent||n.accent){const t=n.colors?.accent||n.accent;return Xt(t,n.name||"Migrated Theme")}return null}catch(t){return console.error("Theme migration failed:",t),null}},Xt=(n,e)=>{const t=n.split(/\s+/).map(Number),[r,s,i]=t,c=r*.299+s*.587+i*.114<128;return{id:`custom-${Date.now()}`,name:e,colors:{primary:n,secondary:c?"45 55 72":"229 231 235",accent:n,background:c?"26 32 44":"255 255 255",surface:c?"45 55 72":"249 250 251",text:c?"247 250 252":"17 24 39",textSecondary:c?"160 174 192":"107 114 128",border:c?"75 85 99":"209 213 219",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},Sr=n=>{const e=document.documentElement;Object.entries(n.colors).forEach(([d,h])=>{e.style.setProperty(`--color-${d}`,h)});const r={compact:{padding:"0.5rem",gap:"0.5rem"},comfortable:{padding:"1rem",gap:"1rem"},spacious:{padding:"1.5rem",gap:"1.5rem"}}[n.layout];e.style.setProperty("--layout-padding",r.padding),e.style.setProperty("--layout-gap",r.gap);const i={low:{fontSize:"0.875rem",lineHeight:"1.25rem"},medium:{fontSize:"1rem",lineHeight:"1.5rem"},high:{fontSize:"1.125rem",lineHeight:"1.75rem"}}[n.density];e.style.setProperty("--density-font-size",i.fontSize),e.style.setProperty("--density-line-height",i.lineHeight);const c={none:"0",small:"0.25rem",medium:"0.5rem",large:"1rem"};e.style.setProperty("--border-radius",c[n.borderRadius]),e.style.setProperty("--shadows-enabled",n.shadows?"1":"0"),e.style.setProperty("--animations-enabled",n.animations?"1":"0"),e.style.setProperty("--transition-duration",n.animations?"0.2s":"0s")},wr=()=>typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"dark",_r=n=>{const e=Ue.filter(t=>t.category===n||n==="dark"&&t.category==="colorful");return e.length>0?e[0].theme:Ue[0].theme},Yt={log:n=>{}},Hn={maxSize:500,maxAge:1440*60*1e3,memoryLimit:50,autoCleanupInterval:300*1e3};class Gn{constructor(e={}){this.options={...Hn,...e},this.cache=new Map,this.stats={hits:0,misses:0,evictions:0},this.cleanupInterval=null,this.options.autoCleanupInterval>0&&this.startAutoCleanup()}getKey(e){return`${e.link}|${e.sourceTitle}`}get(e,t){let r;if(typeof e=="string"&&t)r=`${e}|${t}`;else if(typeof e=="object")r=this.getKey(e);else throw new Error("Invalid arguments to get()");const s=this.cache.get(r);return s?(this.cache.delete(r),this.cache.set(r,{article:s.article,timestamp:s.timestamp}),this.stats.hits++,s.article):(this.stats.misses++,null)}set(e){const t=this.getKey(e);this.cache.delete(t),this.cache.set(t,{article:e,timestamp:Date.now()}),this.enforceConstraints()}setMany(e){e.forEach(t=>this.set(t))}has(e,t){let r;if(typeof e=="string"&&t)r=`${e}|${t}`;else if(typeof e=="object")r=this.getKey(e);else throw new Error("Invalid arguments to has()");return this.cache.has(r)}delete(e,t){let r;if(typeof e=="string"&&t)r=`${e}|${t}`;else if(typeof e=="object")r=this.getKey(e);else throw new Error("Invalid arguments to delete()");return this.cache.delete(r)}clear(){this.cache.clear()}size(){return this.cache.size}getAll(){return Array.from(this.cache.values()).map(e=>e.article)}getStats(){const e=Date.now();let t=0,r=e,s=0;this.cache.forEach(({timestamp:E})=>{t+=e-E,E<r&&(r=E),E>s&&(s=E)});const i=this.cache.size,c=i>0?t/i:0,d=i>0?e-r:0,h=i>0?e-s:0;let m=null;return"memory"in performance&&(m=Math.round(performance.memory.usedJSHeapSize/(1024*1024))),{hits:this.stats.hits,misses:this.stats.misses,hitRate:this.stats.hits+this.stats.misses>0?this.stats.hits/(this.stats.hits+this.stats.misses):0,size:i,maxSize:this.options.maxSize,evictions:this.stats.evictions,oldestItemAge:d,newestItemAge:h,averageAge:c,memoryUsage:m}}enforceConstraints(){this.enforceMaxSize(),this.enforceMaxAge(),this.enforceMemoryLimit()}enforceMaxSize(){if(this.cache.size<=this.options.maxSize)return;const e=this.cache.size-this.options.maxSize;if(e<=0)return;const t=Array.from(this.cache.entries()).sort((r,s)=>r[1].timestamp-s[1].timestamp);for(let r=0;r<e;r++)r<t.length&&(this.cache.delete(t[r][0]),this.stats.evictions++)}enforceMaxAge(){if(this.options.maxAge<=0)return;const e=Date.now();this.cache.forEach((t,r)=>{e-t.timestamp>this.options.maxAge&&(this.cache.delete(r),this.stats.evictions++)})}enforceMemoryLimit(){if(this.options.memoryLimit<=0||!("memory"in performance))return;const t=performance.memory.usedJSHeapSize/(1024*1024);if(t<this.options.memoryLimit)return;const r=Math.max(1,Math.ceil(this.cache.size*.1)),s=Array.from(this.cache.entries()).sort((i,c)=>i[1].timestamp-c[1].timestamp);for(let i=0;i<r&&i<s.length;i++)this.cache.delete(s[i][0]),this.stats.evictions++;Yt.log(`Evicted ${r} articles from cache due to memory limit (${t.toFixed(2)}MB used)`)}startAutoCleanup(){this.cleanupInterval===null&&(this.cleanupInterval=window.setInterval(()=>{this.cleanup()},this.options.autoCleanupInterval),Yt.log(`Started automatic cache cleanup every ${this.options.autoCleanupInterval/1e3} seconds`))}stopAutoCleanup(){this.cleanupInterval!==null&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}cleanup(){this.cache.size,this.enforceMaxAge(),this.enforceMemoryLimit(),this.cache.size}resetStats(){this.stats={hits:0,misses:0,evictions:0}}}const Cr=new Gn;class jn{constructor(){this.logs=[],this.maxLogs=100,this.listeners=[],this.originalConsole={log:console.log,warn:console.warn,error:console.error,info:console.info,debug:console.debug},this.init()}init(){console.log=(...e)=>{this.addLog("log",e),this.originalConsole.log(...e)},console.info=(...e)=>{this.addLog("info",e),this.originalConsole.info(...e)},console.warn=(...e)=>{this.addLog("warn",e),this.originalConsole.warn(...e)},console.error=(...e)=>{this.addLog("error",e),this.originalConsole.error(...e)}}addLog(e,t){const r=t.map(i=>typeof i=="object"?JSON.stringify(i,null,2):String(i)).join(" "),s={id:Math.random().toString(36).substr(2,9),timestamp:Date.now(),type:e,message:r,data:t};this.logs=[s,...this.logs].slice(0,this.maxLogs),this.notifyListeners()}getLogs(){return this.logs}clearLogs(){this.logs=[],this.notifyListeners()}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}log(...e){this.addLog("log",e),this.originalConsole.log(...e)}info(...e){this.addLog("info",e),this.originalConsole.info(...e)}warn(...e){this.addLog("warn",e),this.originalConsole.warn(...e)}error(...e){this.addLog("error",e),this.originalConsole.error(...e)}debug(...e){this.addLog("debug",e),this.originalConsole.debug?this.originalConsole.debug(...e):this.originalConsole.log("[DEBUG]",...e)}notifyListeners(){this.listeners.forEach(e=>e(this.logs))}}const M=new jn,Xn=()=>M,xr=n=>M,en=600*1e3,tn=100,nn=7200*1e3,lt="smart-feed-cache";class Yn{constructor(e={}){this.cache=new Map,this.stats={hits:0,misses:0,sets:0,evictions:0},this.options={ttl:e.ttl||en,maxEntries:e.maxEntries||tn,enablePersistence:e.enablePersistence!==!1,enableStaleWhileRevalidate:e.enableStaleWhileRevalidate||nn},this.options.enablePersistence&&this.loadFromStorage(),this.setupPeriodicCleanup()}get(e){const t=this.cache.get(e);if(!t)return this.stats.misses++,null;const r=Date.now(),s=r-t.timestamp;return t.accessCount++,t.lastAccessed=r,s<=this.options.ttl?(this.stats.hits++,M.debug("Cache hit for feed (fresh)",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(s/1e3),ttl:Math.round(this.options.ttl/1e3),articlesCount:t.articles.length}}),t.articles):s<=this.options.enableStaleWhileRevalidate?(this.stats.hits++,M.debug("Cache hit for feed (stale)",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(s/1e3),staleLimit:Math.round(this.options.enableStaleWhileRevalidate/1e3),articlesCount:t.articles.length}}),t.articles):(this.cache.delete(e),this.stats.misses++,M.debug("Cache expired for feed",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(s/1e3),staleLimit:Math.round(this.options.enableStaleWhileRevalidate/1e3)}}),null)}getStaleWhileRevalidate(e){const t=this.cache.get(e);if(!t)return null;const r=Date.now(),s=r-t.timestamp;return s<=this.options.enableStaleWhileRevalidate?(t.lastAccessed=r,M.debug("Serving stale content while revalidating",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(s/1e3),articlesCount:t.articles.length}}),t.articles):null}isFresh(e){const t=this.cache.get(e);return t?Date.now()-t.timestamp<=this.options.ttl:!1}isStale(e){const t=this.cache.get(e);if(!t)return!1;const r=Date.now()-t.timestamp;return r>this.options.ttl&&r<=this.options.enableStaleWhileRevalidate}set(e,t,r,s){const i=Date.now(),c={articles:t.map(d=>({...d,pubDate:new Date(d.pubDate)})),timestamp:i,feedUrl:e,title:r,etag:s?.get("etag")||void 0,lastModified:s?.get("last-modified")||void 0,accessCount:1,lastAccessed:i};this.cache.size>=this.options.maxEntries&&this.evictLeastRecentlyUsed(),this.cache.set(e,c),this.stats.sets++,M.debug("Cached articles for feed",{component:"SmartCache",additionalData:{feedUrl:e,articlesCount:t.length,title:r,hasEtag:!!c.etag,hasLastModified:!!c.lastModified,cacheSize:this.cache.size}}),this.options.enablePersistence&&this.persistToStorage()}delete(e){const t=this.cache.delete(e);return t&&(M.debug("Removed cache entry for feed",{component:"SmartCache",additionalData:{feedUrl:e}}),this.options.enablePersistence&&this.persistToStorage()),t}clear(){const e=this.cache.size;this.cache.clear(),M.info("Cleared all cache entries",{component:"SmartCache",additionalData:{clearedEntries:e}}),this.options.enablePersistence&&this.persistToStorage()}getStats(){const e=Array.from(this.cache.values()),t=e.reduce((i,c)=>i+c.articles.length,0),r=e.map(i=>i.timestamp),s=this.stats.hits+this.stats.misses>0?this.stats.hits/(this.stats.hits+this.stats.misses):0;return{totalEntries:this.cache.size,totalArticles:t,cacheSize:this.estimateCacheSize(),hitRate:s,oldestEntry:r.length>0?Math.min(...r):0,newestEntry:r.length>0?Math.max(...r):0}}getKeys(){return Array.from(this.cache.keys())}has(e){return this.cache.has(e)}getMetadata(e){const t=this.cache.get(e);if(!t)return null;const{articles:r,...s}=t;return s}cleanup(){const e=Date.now(),t=[];for(const[r,s]of this.cache.entries())e-s.timestamp>this.options.enableStaleWhileRevalidate&&t.push(r);return t.forEach(r=>this.cache.delete(r)),t.length>0&&(M.info("Cleaned up expired cache entries",{component:"SmartCache",additionalData:{expiredCount:t.length,remainingCount:this.cache.size}}),this.options.enablePersistence&&this.persistToStorage()),t.length}evictLeastRecentlyUsed(){let e=null,t=Date.now();for(const[r,s]of this.cache.entries())s.lastAccessed<t&&(t=s.lastAccessed,e=r);e&&(this.cache.delete(e),this.stats.evictions++,M.debug("Evicted LRU cache entry",{component:"SmartCache",additionalData:{evictedKey:e,lastAccessed:new Date(t).toISOString()}}))}estimateCacheSize(){let e=0;for(const t of this.cache.values())e+=JSON.stringify(t).length*2;return e}loadFromStorage(){try{const e=localStorage.getItem(lt);if(!e)return;const t=JSON.parse(e),r=Date.now();for(const[s,i]of t.entries||[]){const c={...i,articles:i.articles.map(h=>({...h,pubDate:new Date(h.pubDate)}))};r-c.timestamp<=this.options.enableStaleWhileRevalidate&&this.cache.set(s,c)}M.info("Loaded cache from storage",{component:"SmartCache",additionalData:{loadedEntries:this.cache.size,totalStored:t.entries?.length||0}})}catch(e){M.error("Failed to load cache from storage",e,{component:"SmartCache"}),localStorage.removeItem(lt)}}persistToStorage(){try{const e=Array.from(this.cache.entries()).map(([r,s])=>[r,{...s,articles:s.articles.map(i=>({...i,pubDate:i.pubDate.toISOString()}))}]),t={entries:e,timestamp:Date.now(),version:"1.0.0"};localStorage.setItem(lt,JSON.stringify(t)),M.debug("Persisted cache to storage",{component:"SmartCache",additionalData:{entriesCount:e.length,estimatedSize:JSON.stringify(t).length}})}catch(e){M.error("Failed to persist cache to storage",e,{component:"SmartCache",additionalData:{cacheSize:this.cache.size,estimatedSize:this.estimateCacheSize()}})}}setupPeriodicCleanup(){setInterval(()=>{this.cleanup()},300*1e3)}}const gt=new Yn({ttl:en,maxEntries:tn,enablePersistence:!0,enableStaleWhileRevalidate:nn}),Vn=n=>gt.get(n),Kn=(n,e,t,r)=>{gt.set(n,e,t,r)},Rr=n=>gt.isFresh(n),rn={maxXmlSize:10*1024*1024,allowedRootElements:["rss","feed","rdf:rdf","rdf"],blockedPatterns:[/<!ENTITY[^>]*SYSTEM/i,/<!ENTITY[^>]*PUBLIC/i,/javascript:/gi,/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,/on\w+\s*=\s*["'][^"']*["']/gi,/data:text\/html/gi,/vbscript:/gi,/expression\s*\(/gi]};function on(n,e){if(n.length>e.maxXmlSize)throw new Error(`XML size exceeds security limit of ${e.maxXmlSize} bytes`);for(const t of e.blockedPatterns)if(t.test(n))throw new Error("Potentially malicious XML content detected: blocked pattern found")}function qn(n,e){const t=n.documentElement;if(!t)throw new Error("No valid XML root element found");const r=t.tagName.toLowerCase();if(!e.allowedRootElements.some(i=>r===i.toLowerCase()))throw new Error(`Root element '${r}' is not in allowed list: ${e.allowedRootElements.join(", ")}`);const s=Array.from(n.childNodes).filter(i=>i.nodeType===Node.ELEMENT_NODE);if(s.length>1)throw new Error(`XML contains ${s.length} root nodes, but only 1 is allowed`)}function Et(n){if(!n)return"";let e=n;return e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&apos;/g,"'"),e=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/on\w+\s*=\s*["'][^"']*["']/gi,"").replace(/javascript:/gi,"").replace(/vbscript:/gi,"").replace(/data:text\/html/gi,"").replace(/expression\s*\(/gi,"").replace(/<[^>]*>/g,""),e=e.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").trim(),e}function Jn(n,e){if(!n)return"";const r=n.querySelector(e)?.textContent||"";return Et(r)}function Zn(n,e){if(!n)return"";const t=n.getAttribute(e)||"";return Et(t)}function Qn(n,e=rn){try{if(!n||typeof n!="string")throw new Error("Invalid XML input: must be a non-empty string");const t=n.trim();if(!t)throw new Error("Invalid XML input: must be a non-empty string");on(t,e);const s=new DOMParser().parseFromString(t,"application/xml"),i=s.querySelector("parsererror");if(i)throw new Error(`XML parsing error: ${i.textContent}`);return qn(s,e),s}catch(t){throw console.error("Secure XML parsing error:",t),new Error(`Failed to parse XML securely: ${t instanceof Error?t.message:"Unknown error"}`)}}function er(n){const e={...rn,allowedRootElements:["rss","feed","rdf:rdf","rdf"]};return Qn(n,e)}const Tt={getSecureTextContent:Jn,getSecureAttributeValue:Zn,sanitizeTextContent:Et,validateXmlSecurity:on},tr=[{original:"http://feeds.feedburner.com/tecnoblog",alternatives:["https://tecnoblog.net/feed/","https://tecnoblog.net/rss/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/Techcrunch",alternatives:["https://techcrunch.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/blogdoiphone/rss",alternatives:["https://blogdoiphone.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://macmagazine.com.br/feed/",alternatives:["https://macmagazine.com.br/feed/"],notes:"HTTP to HTTPS redirect"},{original:"http://feeds2.feedburner.com/canaltechbr",alternatives:["https://canaltech.com.br/rss/","https://canaltech.com.br/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/guiadopc",alternatives:["https://guiadopc.com.br/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://meiobit.com/index.xml",alternatives:["https://meiobit.com/feed/","https://meiobit.com/index.xml"],notes:"HTTP to HTTPS redirect"},{original:"http://feeds.feedburner.com/design-milk",alternatives:["https://design-milk.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/core77/blog",alternatives:["https://www.core77.com/rss/object.xml"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/dezeen",alternatives:["https://www.dezeen.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/JustCreativeDesignBlog",alternatives:["https://justcreative.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds2.feedburner.com/thenextweb",alternatives:["https://thenextweb.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/brainstorm9",alternatives:["https://www.brainstorm9.com/feed/"],notes:"FeedBurner redirect to direct feed"}];function nr(n){const e=[n],t=tr.find(r=>r.original===n);if(t&&e.push(...t.alternatives),n.startsWith("http://")){const r=n.replace("http://","https://");e.includes(r)||e.push(r)}return[...new Set(e)]}const rr=8e3,or=2,sr=500,H=Xn(),ir=[{name:"RSS2JSON",url:"https://api.rss2json.com/v1/api.json",format:n=>`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(n)}`,parser:lr},{name:"AllOrigins",url:"https://api.allorigins.win/raw",format:n=>`https://api.allorigins.win/raw?url=${encodeURIComponent(n)}`,parser:ut},{name:"CodeTabs",url:"https://api.codetabs.com/v1/proxy",format:n=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(n)}`,parser:ut},{name:"CORSProxy",url:"https://corsproxy.io",format:n=>`https://corsproxy.io/?${encodeURIComponent(n)}`,parser:ut}];class ar{constructor(){this.failures=new Map,this.threshold=3,this.timeout=6e4}isOpen(e){const t=this.failures.get(e);return t?Date.now()-t.lastAttempt>this.timeout?(this.failures.delete(e),!1):t.count>=this.threshold:!1}recordFailure(e){const t=this.failures.get(e)||{count:0,lastAttempt:0};t.count++,t.lastAttempt=Date.now(),this.failures.set(e,t)}recordSuccess(e){this.failures.delete(e)}}const ht=new ar;function sn(n){return Tt.sanitizeTextContent(n)}function ue(n){return Tt.sanitizeTextContent(n)}function an(n){return Tt.sanitizeTextContent(n)}async function cr(n,e={}){const{timeout:t=rr,...r}=e,s=new AbortController,i=setTimeout(()=>s.abort(),t);try{const c=await fetch(n,{...r,signal:s.signal,headers:{Accept:"application/rss+xml, application/xml, application/atom+xml, text/xml, application/json, */*",...r.headers}});return clearTimeout(i),c}catch(c){throw clearTimeout(i),c instanceof Error&&c.name==="AbortError"?new Error(`Request timeout after ${t}ms`):c}}function lr(n,e){const t=JSON.parse(n);if(t.status==="error")throw new Error(`RSS2JSON error: ${t.message||"Unknown error"}`);if(t.status!=="ok"||!t.items)throw new Error("Invalid RSS2JSON response format");const r=t.items.map(s=>{let i=s.thumbnail||s.enclosure?.link;if(i)try{new URL(i).protocol.startsWith("http")||(i=void 0),i&&(i.includes("?text=")||i.match(/^[A-Z0-9]{6}\?text=/i)||!i.includes("."))&&(i=void 0)}catch{i=void 0}const c=s.description?sn(s.description).substring(0,500):"",d=s.content||s.description||"",h=Qt(d);return{title:s.title?ue(s.title):"No Title",link:s.link||e,pubDate:s.pubDate?new Date(s.pubDate):new Date,description:c,content:h||void 0,sourceTitle:t.feed?.title?ue(t.feed.title):"RSS Feed",author:s.author?an(s.author):void 0,categories:s.categories||[],imageUrl:i||void 0,audioUrl:s.enclosure?.link&&s.enclosure?.type?.startsWith("audio/")?s.enclosure.link:void 0,audioDuration:void 0}});return{title:t.feed?.title||"RSS Feed",articles:r}}function ut(n,e){const t=er(n),r=t.getElementsByTagName("parsererror");if(r.length>0)throw new Error(`XML parsing error: ${r[0].textContent}`);let s="Untitled Feed",i;const c=t.getElementsByTagName("channel");if(c.length>0)s=c[0].getElementsByTagName("title")[0]?.textContent?.trim()||"Untitled Feed",s=ue(s),i=t.getElementsByTagName("item");else{const h=t.getElementsByTagName("feed");if(h.length>0)s=h[0].getElementsByTagName("title")[0]?.textContent?.trim()||"Untitled Feed",s=ue(s),i=t.getElementsByTagName("entry");else{const m=t.getElementsByTagName("item");if(m.length>0){const E=t.getElementsByTagName("channel");E.length>0&&(s=E[0].getElementsByTagName("title")[0]?.textContent?.trim()||"Untitled Feed",s=ue(s)),i=m}else throw new Error("Unsupported RSS format")}}const d=[];for(let h=0;h<Math.min(i.length,50);h++){const m=i[h];try{const S=m.getElementsByTagName("title")[0]?.textContent?.trim()||"No Title",B=ue(S);let $="";const j=m.getElementsByTagName("link");j.length>0&&($=j[0].textContent?.trim()||j[0].getAttribute("href")||"");let Se=new Date;const ze=m.getElementsByTagName("pubDate"),Be=m.getElementsByTagName("published"),$e=m.getElementsByTagName("date"),J=ze[0]||Be[0]||$e[0];if(J?.textContent){const g=new Date(J.textContent.trim());isNaN(g.getTime())||(Se=g)}let b="",k="";const ee=m.getElementsByTagName("description"),We=m.getElementsByTagName("summary"),He=m.getElementsByTagName("content"),Ge=m.getElementsByTagName("content:encoded"),je=m.getElementsByTagName("body"),x=ee[0]||We[0];x?.textContent&&(b=x.textContent);const te=Ge[0]||He[0]||je[0]||ee[0];te?.textContent&&(k=te.textContent),!b&&k&&(b=k),!k&&b&&(k=b);const me=sn(b).substring(0,500),de=Qt(k);let we="";const Xe=m.getElementsByTagName("author"),Ye=m.getElementsByTagName("creator"),_e=m.getElementsByTagName("dc:creator"),Ce=Xe[0]||_e[0]||Ye[0];if(Ce?.textContent){const g=Ce.textContent.trim();we=an(g)}const fe=[],w=m.getElementsByTagName("category");for(let g=0;g<w.length;g++){const _=w[g].textContent?.trim();_&&fe.push(_)}let R="",A="",ne="";const T=m.getElementsByTagName("enclosure");for(let g=0;g<T.length;g++){const _=T[g],I=_.getAttribute("type"),U=_.getAttribute("url")||"";if(I&&I.startsWith("image/")&&!R&&(R=U),I&&I.startsWith("audio/")&&!A){A=U;const xe=_.getAttribute("length")}}if(A&&!ne){const g=m.getElementsByTagName("itunes:duration"),_=m.getElementsByTagName("duration"),I=g[0]||_[0];I?.textContent&&(ne=I.textContent.trim())}if(!R){const g=m.getElementsByTagName("media:content");for(let _=0;_<g.length;_++){const I=g[_],U=I.getAttribute("type");if(U&&U.startsWith("image/")){R=I.getAttribute("url")||"";break}}}if(!R){const g=m.getElementsByTagName("media:thumbnail");g.length>0&&(R=g[0].getAttribute("url")||"")}if(!R){const g=k||b||"",_=[/<img[^>]+src=["']([^"']+)["'][^>]*>/i,/src=["']([^"']+\.(?:jpg|jpeg|png|gif|webp|svg))[^"']*/i,/https?:\/\/[^\s<>"]+\.(?:jpg|jpeg|png|gif|webp|svg)/i];for(const I of _){const U=g.match(I);if(U&&U[1]){R=U[1];break}}}let q;if(R)try{const g=new URL(R);(g.protocol==="http:"||g.protocol==="https:")&&!R.includes("?text=")&&!R.match(/^[A-Z0-9]{6}\?text=/i)&&R.includes(".")&&(q=R)}catch{H.debug(`Invalid image URL filtered: ${R}`,{component:"rssParser"})}B!=="No Title"&&$&&d.push({title:B,link:$,pubDate:Se,description:me,content:de||void 0,imageUrl:q,author:we||void 0,categories:fe,sourceTitle:s,audioUrl:A||void 0,audioDuration:ne||void 0})}catch(E){H.warn(`Failed to parse article ${h+1}`,{component:"rssParser",additionalData:{error:E instanceof Error?E.message:String(E)}})}}return{title:s,articles:d}}function ur(n){if(!n||n.trim().length===0)return!1;const e=n.trim();return e.toLowerCase().includes("<!doctype html")||e.toLowerCase().startsWith("<html")?!1:e.startsWith("<")||e.startsWith("{")}async function mr(n,e,t){if(ht.isOpen(n.name))throw new Error(`Circuit breaker open for ${n.name}`);const r=n.format(e);H.debug(`Trying provider: ${n.name}`,{component:"rssParser",additionalData:{feedUrl:e,proxyUrl:r}});const s=await cr(r,{signal:t});if(!s.ok)throw s.status===422?new Error(`Provider ${n.name} cannot process this feed (422 Unprocessable Entity)`):new Error(`Provider ${n.name} returned ${s.status}: ${s.statusText}`);const i=await s.text();if(!ur(i))throw new Error(`Invalid response from ${n.name}`);const c=n.parser(i,e);if(!c.articles||c.articles.length===0)throw new Error(`No articles parsed from ${n.name}`);return ht.recordSuccess(n.name),H.info(`Successfully fetched via ${n.name}`,{component:"rssParser",additionalData:{feedUrl:e,provider:n.name,articlesCount:c.articles.length}}),c}async function dr(n,e){const t=nr(n);let r=new Error("Unknown error");for(const s of t)for(const i of ir)try{return await mr(i,s,e)}catch(c){r=c instanceof Error?c:new Error(String(c)),ht.recordFailure(i.name),H.debug(`Provider ${i.name} failed for ${s}`,{component:"rssParser",additionalData:{error:r.message}})}throw new Error(`All providers failed. Last error: ${r.message}`)}function fr(n){return new Promise(e=>setTimeout(e,n))}async function hr(n,e={}){const{maxRetries:t=or,signal:r}=e;let s=new Error("Unknown error");for(let i=1;i<=t;i++)try{H.debug(`Fetching feed (attempt ${i}/${t})`,{component:"rssParser",additionalData:{feedUrl:n}});const c=await dr(n,r);return c.articles.length>0&&Kn(n,c.articles,c.title),H.info(`Successfully fetched feed on attempt ${i}`,{component:"rssParser",additionalData:{feedUrl:n,articlesCount:c.articles.length,attempt:i}}),c}catch(c){if(s=c instanceof Error?c:new Error(String(c)),r?.aborted)throw new Error("Request was cancelled");if(i===t)break;const d=sr*Math.pow(2,i-1);H.warn(`Attempt ${i} failed, retrying in ${d}ms`,{component:"rssParser",additionalData:{feedUrl:n,error:s.message}}),await fr(d)}throw H.error(`All ${t} attempts failed`,s,{component:"rssParser",additionalData:{feedUrl:n}}),s}async function Dr(n,e={}){const{skipCache:t=!1}=e;if(!t){const r=Vn(n);if(r&&r.length>0)return H.debug("Using cached articles",{component:"rssParser",additionalData:{feedUrl:n,cachedCount:r.length}}),{title:r[0].sourceTitle,articles:r}}try{return await hr(n,e)}catch(r){return H.warn("Creating placeholder for failed feed",{component:"rssParser",additionalData:{url:n,error:r instanceof Error?r.message:String(r)}}),{title:"Feed Unavailable",articles:[{title:"RSS Feed Temporarily Unavailable",link:n,pubDate:new Date,description:"Unable to fetch this RSS feed. This may be due to CORS restrictions or temporary server issues. The feed will be retried automatically.",sourceTitle:"System Notice",categories:["system","unavailable"]}]}}}function vr(n){const t=new DOMParser().parseFromString(n,"text/xml"),r=[],s=(c,d)=>{const h=c.getAttribute("xmlUrl"),m=c.getAttribute("text")||c.getAttribute("title");if(h)r.push({url:h,title:m||void 0,category:d});else if(c.children.length>0){const E=m||d;for(let S=0;S<c.children.length;S++){const B=c.children[S];B.tagName.toLowerCase()==="outline"&&s(B,E)}}},i=t.getElementsByTagName("body")[0];if(i)for(let c=0;c<i.children.length;c++){const d=i.children[c];d.tagName.toLowerCase()==="outline"&&s(d)}return r}export{Cr as a,pr as b,Bn as c,_r as d,Sr as e,Ue as f,wr as g,Er as h,br as i,yr as j,vr as k,Vn as l,Ar as m,Dr as n,Rr as o,Zt as p,Tr as q,gr as s,xr as u,$n as v};
