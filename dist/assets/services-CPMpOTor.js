function pr(n){const e={articles:new Map,titleIndex:new Map,contentIndex:new Map,categoryIndex:new Map,sourceIndex:new Map,lastUpdated:Date.now()};return n.forEach((t,r)=>{const s=`${t.link}-${r}`;e.articles.set(s,t),ye(t.title).forEach(d=>{e.titleIndex.has(d)||e.titleIndex.set(d,[]),e.titleIndex.get(d).push(s)}),t.description&&ye(t.description).forEach(p=>{e.contentIndex.has(p)||e.contentIndex.set(p,[]),e.contentIndex.get(p).push(s)}),t.categories&&t.categories.forEach(d=>{ye(d).forEach(u=>{e.categoryIndex.has(u)||e.categoryIndex.set(u,[]),e.categoryIndex.get(u).push(s)})}),ye(t.sourceTitle).forEach(d=>{e.sourceIndex.has(d)||e.sourceIndex.set(d,[]),e.sourceIndex.get(d).push(s)})}),e}function ye(n){return n.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(e=>e.length>2)}function gr(n,e,t={}){const{includeTitle:r=!0,includeContent:s=!0,includeCategories:i=!0,includeSource:c=!0,fuzzyThreshold:d=.6}=t;if(!e.trim())return[];const p=ye(e),u=new Map;p.forEach(b=>{r&&Ie(n.titleIndex,b,d,u,"title",3),s&&Ie(n.contentIndex,b,d,u,"content",1),i&&Ie(n.categoryIndex,b,d,u,"category",2),c&&Ie(n.sourceIndex,b,d,u,"source",1.5)});const E=[];return u.forEach((b,U)=>{const z=n.articles.get(U);z&&E.push({article:z,score:b.score,matchedFields:Array.from(b.matchedFields)})}),E.sort((b,U)=>U.score-b.score)}function Ie(n,e,t,r,s,i){n.forEach((c,d)=>{const p=pn(e,d);if(p>=t){const u=p*i;c.forEach(E=>{r.has(E)||r.set(E,{score:0,matchedFields:new Set});const b=r.get(E);b.score+=u,b.matchedFields.add(s)})}})}function pn(n,e){if(n===e)return 1;if(n.includes(e)||e.includes(n))return .9;const t=Math.max(n.length,e.length);return t===0?1:1-gn(n,e)/t}function gn(n,e){const t=Array(e.length+1).fill(null).map(()=>Array(n.length+1).fill(null));for(let r=0;r<=n.length;r++)t[0][r]=r;for(let r=0;r<=e.length;r++)t[r][0]=r;for(let r=1;r<=e.length;r++)for(let s=1;s<=n.length;s++){const i=n[s-1]===e[r-1]?0:1;t[r][s]=Math.min(t[r][s-1]+1,t[r-1][s]+1,t[r-1][s-1]+i)}return t[e.length][n.length]}function Er(n,e){if(!e.trim())return n;const t=e.trim().split(/\s+/);let r=n;return t.forEach(s=>{const i=En(s),c=new RegExp(`(${i})`,"gi");r=r.replace(c,"<mark>$1</mark>")}),r}function En(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}/*! @license DOMPurify 3.3.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.0/LICENSE */const{entries:Vt,setPrototypeOf:Ut,isFrozen:Tn,getPrototypeOf:yn,getOwnPropertyDescriptor:bn}=Object;let{freeze:L,seal:k,create:lt}=Object,{apply:mt,construct:ut}=typeof Reflect<"u"&&Reflect;L||(L=function(e){return e});k||(k=function(e){return e});mt||(mt=function(e,t){for(var r=arguments.length,s=new Array(r>2?r-2:0),i=2;i<r;i++)s[i-2]=arguments[i];return e.apply(t,s)});ut||(ut=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return new e(...r)});const Le=M(Array.prototype.forEach),Sn=M(Array.prototype.lastIndexOf),zt=M(Array.prototype.pop),he=M(Array.prototype.push),An=M(Array.prototype.splice),Oe=M(String.prototype.toLowerCase),tt=M(String.prototype.toString),nt=M(String.prototype.match),pe=M(String.prototype.replace),wn=M(String.prototype.indexOf),_n=M(String.prototype.trim),$=M(Object.prototype.hasOwnProperty),N=M(RegExp.prototype.test),ge=Cn(TypeError);function M(n){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return mt(n,e,r)}}function Cn(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return ut(n,t)}}function h(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Oe;Ut&&Ut(n,null);let r=e.length;for(;r--;){let s=e[r];if(typeof s=="string"){const i=t(s);i!==s&&(Tn(e)||(e[r]=i),s=i)}n[s]=!0}return n}function xn(n){for(let e=0;e<n.length;e++)$(n,e)||(n[e]=null);return n}function V(n){const e=lt(null);for(const[t,r]of Vt(n))$(n,t)&&(Array.isArray(r)?e[t]=xn(r):r&&typeof r=="object"&&r.constructor===Object?e[t]=V(r):e[t]=r);return e}function Ee(n,e){for(;n!==null;){const r=bn(n,e);if(r){if(r.get)return M(r.get);if(typeof r.value=="function")return M(r.value)}n=yn(n)}function t(){return null}return t}const Bt=L(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),rt=L(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),ot=L(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Rn=L(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),st=L(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Dn=L(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),$t=L(["#text"]),Ht=L(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),it=L(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Wt=L(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Me=L(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),vn=k(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Nn=k(/<%[\w\W]*|[\w\W]*%>/gm),In=k(/\$\{[\w\W]*/gm),Ln=k(/^data-[\-\w.\u00B7-\uFFFF]+$/),Mn=k(/^aria-[\-\w]+$/),qt=k(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),On=k(/^(?:\w+script|data):/i),Fn=k(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Kt=k(/^html$/i),Pn=k(/^[a-z][.\w]*(-[.\w]+)+$/i);var Gt=Object.freeze({__proto__:null,ARIA_ATTR:Mn,ATTR_WHITESPACE:Fn,CUSTOM_ELEMENT:Pn,DATA_ATTR:Ln,DOCTYPE_NAME:Kt,ERB_EXPR:Nn,IS_ALLOWED_URI:qt,IS_SCRIPT_OR_DATA:On,MUSTACHE_EXPR:vn,TMPLIT_EXPR:In});const Te={element:1,text:3,progressingInstruction:7,comment:8,document:9},kn=function(){return typeof window>"u"?null:window},Un=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const s="data-tt-policy-suffix";t&&t.hasAttribute(s)&&(r=t.getAttribute(s));const i="dompurify"+(r?"#"+r:"");try{return e.createPolicy(i,{createHTML(c){return c},createScriptURL(c){return c}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}},jt=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Jt(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:kn();const e=m=>Jt(m);if(e.version="3.3.0",e.removed=[],!n||!n.document||n.document.nodeType!==Te.document||!n.Element)return e.isSupported=!1,e;let{document:t}=n;const r=t,s=r.currentScript,{DocumentFragment:i,HTMLTemplateElement:c,Node:d,Element:p,NodeFilter:u,NamedNodeMap:E=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:b,DOMParser:U,trustedTypes:z}=n,G=p.prototype,be=Ee(G,"cloneNode"),Pe=Ee(G,"remove"),ke=Ee(G,"nextSibling"),Ue=Ee(G,"childNodes"),q=Ee(G,"parentNode");if(typeof c=="function"){const m=t.createElement("template");m.content&&m.content.ownerDocument&&(t=m.content.ownerDocument)}let y,F="";const{implementation:Z,createNodeIterator:ze,createDocumentFragment:Be,getElementsByTagName:$e}=t,{importNode:He}=r;let _=jt();e.isSupported=typeof Vt=="function"&&typeof q=="function"&&Z&&Z.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Q,ERB_EXPR:ce,TMPLIT_EXPR:le,DATA_ATTR:Se,ARIA_ATTR:We,IS_SCRIPT_OR_DATA:Ge,ATTR_WHITESPACE:Ae,CUSTOM_ELEMENT:we}=Gt;let{IS_ALLOWED_URI:me}=Gt,S=null;const x=h({},[...Bt,...rt,...ot,...st,...$t]);let A=null;const ue=h({},[...Ht,...it,...Wt,...Me]);let f=Object.seal(lt(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),R=null,B=null;const P=Object.seal(lt(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Et=!0,je=!0,Tt=!1,yt=!0,ee=!1,_e=!0,K=!1,Xe=!1,Ye=!1,te=!1,Ce=!1,xe=!1,bt=!0,St=!1;const an="user-content-";let Ve=!0,fe=!1,ne={},re=null;const At=h({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let wt=null;const _t=h({},["audio","video","img","source","image","track"]);let qe=null;const Ct=h({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Re="http://www.w3.org/1998/Math/MathML",De="http://www.w3.org/2000/svg",j="http://www.w3.org/1999/xhtml";let oe=j,Ke=!1,Je=null;const cn=h({},[Re,De,j],tt);let ve=h({},["mi","mo","mn","ms","mtext"]),Ne=h({},["annotation-xml"]);const ln=h({},["title","style","font","a","script"]);let de=null;const mn=["application/xhtml+xml","text/html"],un="text/html";let C=null,se=null;const fn=t.createElement("form"),xt=function(o){return o instanceof RegExp||o instanceof Function},Ze=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(se&&se===o)){if((!o||typeof o!="object")&&(o={}),o=V(o),de=mn.indexOf(o.PARSER_MEDIA_TYPE)===-1?un:o.PARSER_MEDIA_TYPE,C=de==="application/xhtml+xml"?tt:Oe,S=$(o,"ALLOWED_TAGS")?h({},o.ALLOWED_TAGS,C):x,A=$(o,"ALLOWED_ATTR")?h({},o.ALLOWED_ATTR,C):ue,Je=$(o,"ALLOWED_NAMESPACES")?h({},o.ALLOWED_NAMESPACES,tt):cn,qe=$(o,"ADD_URI_SAFE_ATTR")?h(V(Ct),o.ADD_URI_SAFE_ATTR,C):Ct,wt=$(o,"ADD_DATA_URI_TAGS")?h(V(_t),o.ADD_DATA_URI_TAGS,C):_t,re=$(o,"FORBID_CONTENTS")?h({},o.FORBID_CONTENTS,C):At,R=$(o,"FORBID_TAGS")?h({},o.FORBID_TAGS,C):V({}),B=$(o,"FORBID_ATTR")?h({},o.FORBID_ATTR,C):V({}),ne=$(o,"USE_PROFILES")?o.USE_PROFILES:!1,Et=o.ALLOW_ARIA_ATTR!==!1,je=o.ALLOW_DATA_ATTR!==!1,Tt=o.ALLOW_UNKNOWN_PROTOCOLS||!1,yt=o.ALLOW_SELF_CLOSE_IN_ATTR!==!1,ee=o.SAFE_FOR_TEMPLATES||!1,_e=o.SAFE_FOR_XML!==!1,K=o.WHOLE_DOCUMENT||!1,te=o.RETURN_DOM||!1,Ce=o.RETURN_DOM_FRAGMENT||!1,xe=o.RETURN_TRUSTED_TYPE||!1,Ye=o.FORCE_BODY||!1,bt=o.SANITIZE_DOM!==!1,St=o.SANITIZE_NAMED_PROPS||!1,Ve=o.KEEP_CONTENT!==!1,fe=o.IN_PLACE||!1,me=o.ALLOWED_URI_REGEXP||qt,oe=o.NAMESPACE||j,ve=o.MATHML_TEXT_INTEGRATION_POINTS||ve,Ne=o.HTML_INTEGRATION_POINTS||Ne,f=o.CUSTOM_ELEMENT_HANDLING||{},o.CUSTOM_ELEMENT_HANDLING&&xt(o.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(f.tagNameCheck=o.CUSTOM_ELEMENT_HANDLING.tagNameCheck),o.CUSTOM_ELEMENT_HANDLING&&xt(o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(f.attributeNameCheck=o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),o.CUSTOM_ELEMENT_HANDLING&&typeof o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(f.allowCustomizedBuiltInElements=o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ee&&(je=!1),Ce&&(te=!0),ne&&(S=h({},$t),A=[],ne.html===!0&&(h(S,Bt),h(A,Ht)),ne.svg===!0&&(h(S,rt),h(A,it),h(A,Me)),ne.svgFilters===!0&&(h(S,ot),h(A,it),h(A,Me)),ne.mathMl===!0&&(h(S,st),h(A,Wt),h(A,Me))),o.ADD_TAGS&&(typeof o.ADD_TAGS=="function"?P.tagCheck=o.ADD_TAGS:(S===x&&(S=V(S)),h(S,o.ADD_TAGS,C))),o.ADD_ATTR&&(typeof o.ADD_ATTR=="function"?P.attributeCheck=o.ADD_ATTR:(A===ue&&(A=V(A)),h(A,o.ADD_ATTR,C))),o.ADD_URI_SAFE_ATTR&&h(qe,o.ADD_URI_SAFE_ATTR,C),o.FORBID_CONTENTS&&(re===At&&(re=V(re)),h(re,o.FORBID_CONTENTS,C)),Ve&&(S["#text"]=!0),K&&h(S,["html","head","body"]),S.table&&(h(S,["tbody"]),delete R.tbody),o.TRUSTED_TYPES_POLICY){if(typeof o.TRUSTED_TYPES_POLICY.createHTML!="function")throw ge('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof o.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw ge('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');y=o.TRUSTED_TYPES_POLICY,F=y.createHTML("")}else y===void 0&&(y=Un(z,s)),y!==null&&typeof F=="string"&&(F=y.createHTML(""));L&&L(o),se=o}},Rt=h({},[...rt,...ot,...Rn]),Dt=h({},[...st,...Dn]),dn=function(o){let a=q(o);(!a||!a.tagName)&&(a={namespaceURI:oe,tagName:"template"});const l=Oe(o.tagName),T=Oe(a.tagName);return Je[o.namespaceURI]?o.namespaceURI===De?a.namespaceURI===j?l==="svg":a.namespaceURI===Re?l==="svg"&&(T==="annotation-xml"||ve[T]):!!Rt[l]:o.namespaceURI===Re?a.namespaceURI===j?l==="math":a.namespaceURI===De?l==="math"&&Ne[T]:!!Dt[l]:o.namespaceURI===j?a.namespaceURI===De&&!Ne[T]||a.namespaceURI===Re&&!ve[T]?!1:!Dt[l]&&(ln[l]||!Rt[l]):!!(de==="application/xhtml+xml"&&Je[o.namespaceURI]):!1},W=function(o){he(e.removed,{element:o});try{q(o).removeChild(o)}catch{Pe(o)}},J=function(o,a){try{he(e.removed,{attribute:a.getAttributeNode(o),from:a})}catch{he(e.removed,{attribute:null,from:a})}if(a.removeAttribute(o),o==="is")if(te||Ce)try{W(a)}catch{}else try{a.setAttribute(o,"")}catch{}},vt=function(o){let a=null,l=null;if(Ye)o="<remove></remove>"+o;else{const w=nt(o,/^[\r\n\t ]+/);l=w&&w[0]}de==="application/xhtml+xml"&&oe===j&&(o='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+o+"</body></html>");const T=y?y.createHTML(o):o;if(oe===j)try{a=new U().parseFromString(T,de)}catch{}if(!a||!a.documentElement){a=Z.createDocument(oe,"template",null);try{a.documentElement.innerHTML=Ke?F:T}catch{}}const v=a.body||a.documentElement;return o&&l&&v.insertBefore(t.createTextNode(l),v.childNodes[0]||null),oe===j?$e.call(a,K?"html":"body")[0]:K?a.documentElement:v},Nt=function(o){return ze.call(o.ownerDocument||o,o,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},Qe=function(o){return o instanceof b&&(typeof o.nodeName!="string"||typeof o.textContent!="string"||typeof o.removeChild!="function"||!(o.attributes instanceof E)||typeof o.removeAttribute!="function"||typeof o.setAttribute!="function"||typeof o.namespaceURI!="string"||typeof o.insertBefore!="function"||typeof o.hasChildNodes!="function")},It=function(o){return typeof d=="function"&&o instanceof d};function X(m,o,a){Le(m,l=>{l.call(e,o,a,se)})}const Lt=function(o){let a=null;if(X(_.beforeSanitizeElements,o,null),Qe(o))return W(o),!0;const l=C(o.nodeName);if(X(_.uponSanitizeElement,o,{tagName:l,allowedTags:S}),_e&&o.hasChildNodes()&&!It(o.firstElementChild)&&N(/<[/\w!]/g,o.innerHTML)&&N(/<[/\w!]/g,o.textContent)||o.nodeType===Te.progressingInstruction||_e&&o.nodeType===Te.comment&&N(/<[/\w]/g,o.data))return W(o),!0;if(!(P.tagCheck instanceof Function&&P.tagCheck(l))&&(!S[l]||R[l])){if(!R[l]&&Ot(l)&&(f.tagNameCheck instanceof RegExp&&N(f.tagNameCheck,l)||f.tagNameCheck instanceof Function&&f.tagNameCheck(l)))return!1;if(Ve&&!re[l]){const T=q(o)||o.parentNode,v=Ue(o)||o.childNodes;if(v&&T){const w=v.length;for(let O=w-1;O>=0;--O){const Y=be(v[O],!0);Y.__removalCount=(o.__removalCount||0)+1,T.insertBefore(Y,ke(o))}}}return W(o),!0}return o instanceof p&&!dn(o)||(l==="noscript"||l==="noembed"||l==="noframes")&&N(/<\/no(script|embed|frames)/i,o.innerHTML)?(W(o),!0):(ee&&o.nodeType===Te.text&&(a=o.textContent,Le([Q,ce,le],T=>{a=pe(a,T," ")}),o.textContent!==a&&(he(e.removed,{element:o.cloneNode()}),o.textContent=a)),X(_.afterSanitizeElements,o,null),!1)},Mt=function(o,a,l){if(bt&&(a==="id"||a==="name")&&(l in t||l in fn))return!1;if(!(je&&!B[a]&&N(Se,a))){if(!(Et&&N(We,a))){if(!(P.attributeCheck instanceof Function&&P.attributeCheck(a,o))){if(!A[a]||B[a]){if(!(Ot(o)&&(f.tagNameCheck instanceof RegExp&&N(f.tagNameCheck,o)||f.tagNameCheck instanceof Function&&f.tagNameCheck(o))&&(f.attributeNameCheck instanceof RegExp&&N(f.attributeNameCheck,a)||f.attributeNameCheck instanceof Function&&f.attributeNameCheck(a,o))||a==="is"&&f.allowCustomizedBuiltInElements&&(f.tagNameCheck instanceof RegExp&&N(f.tagNameCheck,l)||f.tagNameCheck instanceof Function&&f.tagNameCheck(l))))return!1}else if(!qe[a]){if(!N(me,pe(l,Ae,""))){if(!((a==="src"||a==="xlink:href"||a==="href")&&o!=="script"&&wn(l,"data:")===0&&wt[o])){if(!(Tt&&!N(Ge,pe(l,Ae,"")))){if(l)return!1}}}}}}}return!0},Ot=function(o){return o!=="annotation-xml"&&nt(o,we)},Ft=function(o){X(_.beforeSanitizeAttributes,o,null);const{attributes:a}=o;if(!a||Qe(o))return;const l={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:A,forceKeepAttr:void 0};let T=a.length;for(;T--;){const v=a[T],{name:w,namespaceURI:O,value:Y}=v,ie=C(w),et=Y;let D=w==="value"?et:_n(et);if(l.attrName=ie,l.attrValue=D,l.keepAttr=!0,l.forceKeepAttr=void 0,X(_.uponSanitizeAttribute,o,l),D=l.attrValue,St&&(ie==="id"||ie==="name")&&(J(w,o),D=an+D),_e&&N(/((--!?|])>)|<\/(style|title|textarea)/i,D)){J(w,o);continue}if(ie==="attributename"&&nt(D,"href")){J(w,o);continue}if(l.forceKeepAttr)continue;if(!l.keepAttr){J(w,o);continue}if(!yt&&N(/\/>/i,D)){J(w,o);continue}ee&&Le([Q,ce,le],kt=>{D=pe(D,kt," ")});const Pt=C(o.nodeName);if(!Mt(Pt,ie,D)){J(w,o);continue}if(y&&typeof z=="object"&&typeof z.getAttributeType=="function"&&!O)switch(z.getAttributeType(Pt,ie)){case"TrustedHTML":{D=y.createHTML(D);break}case"TrustedScriptURL":{D=y.createScriptURL(D);break}}if(D!==et)try{O?o.setAttributeNS(O,w,D):o.setAttribute(w,D),Qe(o)?W(o):zt(e.removed)}catch{J(w,o)}}X(_.afterSanitizeAttributes,o,null)},hn=function m(o){let a=null;const l=Nt(o);for(X(_.beforeSanitizeShadowDOM,o,null);a=l.nextNode();)X(_.uponSanitizeShadowNode,a,null),Lt(a),Ft(a),a.content instanceof i&&m(a.content);X(_.afterSanitizeShadowDOM,o,null)};return e.sanitize=function(m){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=null,l=null,T=null,v=null;if(Ke=!m,Ke&&(m="<!-->"),typeof m!="string"&&!It(m))if(typeof m.toString=="function"){if(m=m.toString(),typeof m!="string")throw ge("dirty is not a string, aborting")}else throw ge("toString is not a function");if(!e.isSupported)return m;if(Xe||Ze(o),e.removed=[],typeof m=="string"&&(fe=!1),fe){if(m.nodeName){const Y=C(m.nodeName);if(!S[Y]||R[Y])throw ge("root node is forbidden and cannot be sanitized in-place")}}else if(m instanceof d)a=vt("<!---->"),l=a.ownerDocument.importNode(m,!0),l.nodeType===Te.element&&l.nodeName==="BODY"||l.nodeName==="HTML"?a=l:a.appendChild(l);else{if(!te&&!ee&&!K&&m.indexOf("<")===-1)return y&&xe?y.createHTML(m):m;if(a=vt(m),!a)return te?null:xe?F:""}a&&Ye&&W(a.firstChild);const w=Nt(fe?m:a);for(;T=w.nextNode();)Lt(T),Ft(T),T.content instanceof i&&hn(T.content);if(fe)return m;if(te){if(Ce)for(v=Be.call(a.ownerDocument);a.firstChild;)v.appendChild(a.firstChild);else v=a;return(A.shadowroot||A.shadowrootmode)&&(v=He.call(r,v,!0)),v}let O=K?a.outerHTML:a.innerHTML;return K&&S["!doctype"]&&a.ownerDocument&&a.ownerDocument.doctype&&a.ownerDocument.doctype.name&&N(Kt,a.ownerDocument.doctype.name)&&(O="<!DOCTYPE "+a.ownerDocument.doctype.name+`>
`+O),ee&&Le([Q,ce,le],Y=>{O=pe(O,Y," ")}),y&&xe?y.createHTML(O):O},e.setConfig=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ze(m),Xe=!0},e.clearConfig=function(){se=null,Xe=!1},e.isValidAttribute=function(m,o,a){se||Ze({});const l=C(m),T=C(o);return Mt(l,T,a)},e.addHook=function(m,o){typeof o=="function"&&he(_[m],o)},e.removeHook=function(m,o){if(o!==void 0){const a=Sn(_[m],o);return a===-1?void 0:An(_[m],a,1)[0]}return zt(_[m])},e.removeHooks=function(m){_[m]=[]},e.removeAllHooks=function(){_=jt()},e}var zn=Jt();const dt=zn(typeof window<"u"?window:void 0);dt.addHook("afterSanitizeAttributes",function(n){"target"in n&&n.tagName==="A"&&(n.setAttribute("target","_blank"),n.setAttribute("rel","noopener noreferrer"))});function Zt(n){return n?dt.sanitize(n,{ALLOWED_TAGS:["p","br","b","i","em","strong","u","a","img","h1","h2","h3","h4","h5","h6","ul","ol","li","blockquote","code","pre","span","div","table","thead","tbody","tr","td","th"],ALLOWED_ATTR:["href","src","alt","title","class","target","rel","width","height"],FORBID_TAGS:["script","style","iframe","object","embed","form","input","button"]}):""}function Bn(n){if(!n)return"";const e=dt.sanitize(n,{ALLOWED_TAGS:[],KEEP_CONTENT:!0});if(typeof document<"u"){const r=document.createElement("textarea");return r.innerHTML=e,r.value}let t=n;for(let r=0;r<5;r++){const s=t;if(t=t.replace(/&amp;/g,"&"),t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&apos;/g,"'").replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/").replace(/&#(\d+);/g,(i,c)=>String.fromCharCode(parseInt(c,10))).replace(/&#x([0-9a-f]+);/gi,(i,c)=>String.fromCharCode(parseInt(c,16))),t=t.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/on\w+\s*=\s*["'][^"']*["']/gi,"").replace(/javascript:/gi,"").replace(/vbscript:/gi,"").replace(/data:text\/html/gi,"").replace(/<[^>]*>/g,"").replace(/<[^<]*$/g,""),t===s)break}return t=t.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"").trim(),t}function Tr(n,e=300){const t=Bn(n);if(t.length<=e)return t;const r=t.substring(0,e),s=r.lastIndexOf(" ");return s>e*.8?r.substring(0,s)+"...":r+"..."}const g=n=>{const e=n.replace("#","");if(!/^[a-fA-F0-9]{3}$|^[a-fA-F0-9]{6}$/.test(e))throw new Error(`Invalid hex color format: ${n}. Expected format: #RRGGBB or #RGB`);let t,r,s;if(e.length===3?(t=parseInt(e[0]+e[0],16),r=parseInt(e[1]+e[1],16),s=parseInt(e[2]+e[2],16)):(t=parseInt(e.substring(0,2),16),r=parseInt(e.substring(2,4),16),s=parseInt(e.substring(4,6),16)),isNaN(t)||isNaN(r)||isNaN(s)||t<0||t>255||r<0||r>255||s<0||s>255)throw new Error(`Invalid hex color conversion result: ${n} -> ${t} ${r} ${s}`);return`${t} ${r} ${s}`},Fe=[{id:"noite-urbana",name:"Noite Urbana",description:"Tema escuro urbano com azul médio e acentos âmbar",category:"dark",theme:{id:"noite-urbana",name:"Noite Urbana",colors:{primary:"18 102 204",secondary:g("#1E1E1E"),accent:"138 101 8",background:g("#121212"),surface:g("#1E1E1E"),text:g("#FFFFFF"),textSecondary:g("#B0B0B0"),border:"75 85 99",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"verde-noturno",name:"Verde Noturno",description:"Tema escuro com verde natural e acentos solares",category:"dark",theme:{id:"verde-noturno",name:"Verde Noturno",colors:{primary:"52 125 54",secondary:g("#1B1F1D"),accent:"122 105 17",background:g("#0D0D0D"),surface:g("#1B1F1D"),text:g("#F1F1F1"),textSecondary:g("#A8A8A8"),border:"75 85 99",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"roxo-nebuloso",name:"Roxo Nebuloso",description:"Tema escuro místico com roxo vibrante e rosa neon",category:"dark",theme:{id:"roxo-nebuloso",name:"Roxo Nebuloso",colors:{primary:"173 46 207",secondary:g("#1A1A23"),accent:"204 51 102",background:g("#101014"),surface:g("#1A1A23"),text:g("#E0E0E0"),textSecondary:g("#9C9C9C"),border:"75 85 99",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"solar-clean",name:"Solar Clean",description:"Tema claro limpo com azul clássico e laranja queimado",category:"light",theme:{id:"solar-clean",name:"Solar Clean",colors:{primary:g("#1976D2"),secondary:g("#F5F5F5"),accent:"184 61 23",background:g("#FFFFFF"),surface:g("#F5F5F5"),text:g("#212121"),textSecondary:g("#616161"),border:"156 163 175",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"verao-pastel",name:"Verão Pastel",description:"Tema claro pastel com rosa vibrante e lilás suave",category:"light",theme:{id:"verao-pastel",name:"Verão Pastel",colors:{primary:"178 48 92",secondary:g("#FFFFFF"),accent:g("#7E57C2"),background:g("#FFF8F0"),surface:g("#FFFFFF"),text:g("#212121"),textSecondary:"97 97 97",border:"156 163 175",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"minimal-ice",name:"Minimal Ice",description:"Tema claro minimalista com ciano frio e coral quente",category:"light",theme:{id:"minimal-ice",name:"Minimal Ice",colors:{primary:"0 129 145",secondary:g("#FFFFFF"),accent:"184 81 49",background:g("#F0F4F8"),surface:g("#FFFFFF"),text:g("#1C1C1C"),textSecondary:g("#5E5E5E"),border:"156 163 175",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}}],yr={currentTheme:Fe.find(n=>n.id==="solar-clean")?.theme||Fe[0].theme,customThemes:[],autoDetectSystemTheme:!0,systemThemeOverride:null,themeTransitions:!0},$n=n=>{const e=["id","name","colors","layout","density","borderRadius"],t=["primary","secondary","accent","background","surface","text","textSecondary","border","success","warning","error"];for(const r of e)if(!(r in n))return console.warn(`Theme validation failed: missing field "${r}"`),!1;if(n.colors){for(const r of t)if(!(r in n.colors))return console.warn(`Theme validation failed: missing color "${r}"`),!1}if(n.colors){for(const[r,s]of Object.entries(n.colors))if(!Hn(s))return console.warn(`Theme validation failed: invalid RGB format for color "${r}": "${s}"`),!1}return!0},Hn=n=>/^\d{1,3}\s+\d{1,3}\s+\d{1,3}$/.test(n)?n.split(/\s+/).map(Number).every(r=>r>=0&&r<=255):!1,br=(n,e="1.0")=>{try{if(typeof n=="string")return Xt(n,"Migrated Theme");if($n(n))return n;if(n.colors?.accent||n.accent){const t=n.colors?.accent||n.accent;return Xt(t,n.name||"Migrated Theme")}return null}catch(t){return console.error("Theme migration failed:",t),null}},Xt=(n,e)=>{const t=n.split(/\s+/).map(Number),[r,s,i]=t,c=r*.299+s*.587+i*.114<128;return{id:`custom-${Date.now()}`,name:e,colors:{primary:n,secondary:c?"45 55 72":"229 231 235",accent:n,background:c?"26 32 44":"255 255 255",surface:c?"45 55 72":"249 250 251",text:c?"247 250 252":"17 24 39",textSecondary:c?"160 174 192":"107 114 128",border:c?"75 85 99":"209 213 219",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},Sr=n=>{const e=document.documentElement;Object.entries(n.colors).forEach(([d,p])=>{e.style.setProperty(`--color-${d}`,p)});const r={compact:{padding:"0.5rem",gap:"0.5rem"},comfortable:{padding:"1rem",gap:"1rem"},spacious:{padding:"1.5rem",gap:"1.5rem"}}[n.layout];e.style.setProperty("--layout-padding",r.padding),e.style.setProperty("--layout-gap",r.gap);const i={low:{fontSize:"0.875rem",lineHeight:"1.25rem"},medium:{fontSize:"1rem",lineHeight:"1.5rem"},high:{fontSize:"1.125rem",lineHeight:"1.75rem"}}[n.density];e.style.setProperty("--density-font-size",i.fontSize),e.style.setProperty("--density-line-height",i.lineHeight);const c={none:"0",small:"0.25rem",medium:"0.5rem",large:"1rem"};e.style.setProperty("--border-radius",c[n.borderRadius]),e.style.setProperty("--shadows-enabled",n.shadows?"1":"0"),e.style.setProperty("--animations-enabled",n.animations?"1":"0"),e.style.setProperty("--transition-duration",n.animations?"0.2s":"0s")},Ar=()=>typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"dark",wr=n=>{const e=Fe.filter(t=>t.category===n||n==="dark"&&t.category==="colorful");return e.length>0?e[0].theme:Fe[0].theme},Yt={log:n=>{}},Wn={maxSize:500,maxAge:1440*60*1e3,memoryLimit:50,autoCleanupInterval:300*1e3};class Gn{constructor(e={}){this.options={...Wn,...e},this.cache=new Map,this.stats={hits:0,misses:0,evictions:0},this.cleanupInterval=null,this.options.autoCleanupInterval>0&&this.startAutoCleanup()}getKey(e){return`${e.link}|${e.sourceTitle}`}get(e,t){let r;if(typeof e=="string"&&t)r=`${e}|${t}`;else if(typeof e=="object")r=this.getKey(e);else throw new Error("Invalid arguments to get()");const s=this.cache.get(r);return s?(this.cache.delete(r),this.cache.set(r,{article:s.article,timestamp:s.timestamp}),this.stats.hits++,s.article):(this.stats.misses++,null)}set(e){const t=this.getKey(e);this.cache.delete(t),this.cache.set(t,{article:e,timestamp:Date.now()}),this.enforceConstraints()}setMany(e){e.forEach(t=>this.set(t))}has(e,t){let r;if(typeof e=="string"&&t)r=`${e}|${t}`;else if(typeof e=="object")r=this.getKey(e);else throw new Error("Invalid arguments to has()");return this.cache.has(r)}delete(e,t){let r;if(typeof e=="string"&&t)r=`${e}|${t}`;else if(typeof e=="object")r=this.getKey(e);else throw new Error("Invalid arguments to delete()");return this.cache.delete(r)}clear(){this.cache.clear()}size(){return this.cache.size}getAll(){return Array.from(this.cache.values()).map(e=>e.article)}getStats(){const e=Date.now();let t=0,r=e,s=0;this.cache.forEach(({timestamp:E})=>{t+=e-E,E<r&&(r=E),E>s&&(s=E)});const i=this.cache.size,c=i>0?t/i:0,d=i>0?e-r:0,p=i>0?e-s:0;let u=null;return"memory"in performance&&(u=Math.round(performance.memory.usedJSHeapSize/(1024*1024))),{hits:this.stats.hits,misses:this.stats.misses,hitRate:this.stats.hits+this.stats.misses>0?this.stats.hits/(this.stats.hits+this.stats.misses):0,size:i,maxSize:this.options.maxSize,evictions:this.stats.evictions,oldestItemAge:d,newestItemAge:p,averageAge:c,memoryUsage:u}}enforceConstraints(){this.enforceMaxSize(),this.enforceMaxAge(),this.enforceMemoryLimit()}enforceMaxSize(){if(this.cache.size<=this.options.maxSize)return;const e=this.cache.size-this.options.maxSize;if(e<=0)return;const t=Array.from(this.cache.entries()).sort((r,s)=>r[1].timestamp-s[1].timestamp);for(let r=0;r<e;r++)r<t.length&&(this.cache.delete(t[r][0]),this.stats.evictions++)}enforceMaxAge(){if(this.options.maxAge<=0)return;const e=Date.now();this.cache.forEach((t,r)=>{e-t.timestamp>this.options.maxAge&&(this.cache.delete(r),this.stats.evictions++)})}enforceMemoryLimit(){if(this.options.memoryLimit<=0||!("memory"in performance))return;const t=performance.memory.usedJSHeapSize/(1024*1024);if(t<this.options.memoryLimit)return;const r=Math.max(1,Math.ceil(this.cache.size*.1)),s=Array.from(this.cache.entries()).sort((i,c)=>i[1].timestamp-c[1].timestamp);for(let i=0;i<r&&i<s.length;i++)this.cache.delete(s[i][0]),this.stats.evictions++;Yt.log(`Evicted ${r} articles from cache due to memory limit (${t.toFixed(2)}MB used)`)}startAutoCleanup(){this.cleanupInterval===null&&(this.cleanupInterval=window.setInterval(()=>{this.cleanup()},this.options.autoCleanupInterval),Yt.log(`Started automatic cache cleanup every ${this.options.autoCleanupInterval/1e3} seconds`))}stopAutoCleanup(){this.cleanupInterval!==null&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}cleanup(){this.cache.size,this.enforceMaxAge(),this.enforceMemoryLimit(),this.cache.size}resetStats(){this.stats={hits:0,misses:0,evictions:0}}}const _r=new Gn;class jn{constructor(){this.logs=[],this.maxLogs=100,this.listeners=[],this.originalConsole={log:console.log,warn:console.warn,error:console.error,info:console.info,debug:console.debug},this.init()}init(){console.log=(...e)=>{this.addLog("log",e),this.originalConsole.log(...e)},console.info=(...e)=>{this.addLog("info",e),this.originalConsole.info(...e)},console.warn=(...e)=>{this.addLog("warn",e),this.originalConsole.warn(...e)},console.error=(...e)=>{this.addLog("error",e),this.originalConsole.error(...e)}}addLog(e,t){const r=t.map(i=>typeof i=="object"?JSON.stringify(i,null,2):String(i)).join(" "),s={id:Math.random().toString(36).substr(2,9),timestamp:Date.now(),type:e,message:r,data:t};this.logs=[s,...this.logs].slice(0,this.maxLogs),this.notifyListeners()}getLogs(){return this.logs}clearLogs(){this.logs=[],this.notifyListeners()}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}log(...e){this.addLog("log",e),this.originalConsole.log(...e)}info(...e){this.addLog("info",e),this.originalConsole.info(...e)}warn(...e){this.addLog("warn",e),this.originalConsole.warn(...e)}error(...e){this.addLog("error",e),this.originalConsole.error(...e)}debug(...e){this.addLog("debug",e),this.originalConsole.debug?this.originalConsole.debug(...e):this.originalConsole.log("[DEBUG]",...e)}notifyListeners(){this.listeners.forEach(e=>e(this.logs))}}const I=new jn,Xn=()=>I,Cr=n=>I,Qt=600*1e3,en=100,tn=7200*1e3,at="smart-feed-cache";class Yn{constructor(e={}){this.cache=new Map,this.stats={hits:0,misses:0,sets:0,evictions:0},this.options={ttl:e.ttl||Qt,maxEntries:e.maxEntries||en,enablePersistence:e.enablePersistence!==!1,enableStaleWhileRevalidate:e.enableStaleWhileRevalidate||tn},this.options.enablePersistence&&this.loadFromStorage(),this.setupPeriodicCleanup()}get(e){const t=this.cache.get(e);if(!t)return this.stats.misses++,null;const r=Date.now(),s=r-t.timestamp;return t.accessCount++,t.lastAccessed=r,s<=this.options.ttl?(this.stats.hits++,I.debug("Cache hit for feed (fresh)",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(s/1e3),ttl:Math.round(this.options.ttl/1e3),articlesCount:t.articles.length}}),t.articles):s<=this.options.enableStaleWhileRevalidate?(this.stats.hits++,I.debug("Cache hit for feed (stale)",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(s/1e3),staleLimit:Math.round(this.options.enableStaleWhileRevalidate/1e3),articlesCount:t.articles.length}}),t.articles):(this.cache.delete(e),this.stats.misses++,I.debug("Cache expired for feed",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(s/1e3),staleLimit:Math.round(this.options.enableStaleWhileRevalidate/1e3)}}),null)}getStaleWhileRevalidate(e){const t=this.cache.get(e);if(!t)return null;const r=Date.now(),s=r-t.timestamp;return s<=this.options.enableStaleWhileRevalidate?(t.lastAccessed=r,I.debug("Serving stale content while revalidating",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(s/1e3),articlesCount:t.articles.length}}),t.articles):null}isFresh(e){const t=this.cache.get(e);return t?Date.now()-t.timestamp<=this.options.ttl:!1}isStale(e){const t=this.cache.get(e);if(!t)return!1;const r=Date.now()-t.timestamp;return r>this.options.ttl&&r<=this.options.enableStaleWhileRevalidate}set(e,t,r,s){const i=Date.now(),c={articles:t.map(d=>({...d,pubDate:new Date(d.pubDate)})),timestamp:i,feedUrl:e,title:r,etag:s?.get("etag")||void 0,lastModified:s?.get("last-modified")||void 0,accessCount:1,lastAccessed:i};this.cache.size>=this.options.maxEntries&&this.evictLeastRecentlyUsed(),this.cache.set(e,c),this.stats.sets++,I.debug("Cached articles for feed",{component:"SmartCache",additionalData:{feedUrl:e,articlesCount:t.length,title:r,hasEtag:!!c.etag,hasLastModified:!!c.lastModified,cacheSize:this.cache.size}}),this.options.enablePersistence&&this.persistToStorage()}delete(e){const t=this.cache.delete(e);return t&&(I.debug("Removed cache entry for feed",{component:"SmartCache",additionalData:{feedUrl:e}}),this.options.enablePersistence&&this.persistToStorage()),t}clear(){const e=this.cache.size;this.cache.clear(),I.info("Cleared all cache entries",{component:"SmartCache",additionalData:{clearedEntries:e}}),this.options.enablePersistence&&this.persistToStorage()}getStats(){const e=Array.from(this.cache.values()),t=e.reduce((i,c)=>i+c.articles.length,0),r=e.map(i=>i.timestamp),s=this.stats.hits+this.stats.misses>0?this.stats.hits/(this.stats.hits+this.stats.misses):0;return{totalEntries:this.cache.size,totalArticles:t,cacheSize:this.estimateCacheSize(),hitRate:s,oldestEntry:r.length>0?Math.min(...r):0,newestEntry:r.length>0?Math.max(...r):0}}getKeys(){return Array.from(this.cache.keys())}has(e){return this.cache.has(e)}getMetadata(e){const t=this.cache.get(e);if(!t)return null;const{articles:r,...s}=t;return s}cleanup(){const e=Date.now(),t=[];for(const[r,s]of this.cache.entries())e-s.timestamp>this.options.enableStaleWhileRevalidate&&t.push(r);return t.forEach(r=>this.cache.delete(r)),t.length>0&&(I.info("Cleaned up expired cache entries",{component:"SmartCache",additionalData:{expiredCount:t.length,remainingCount:this.cache.size}}),this.options.enablePersistence&&this.persistToStorage()),t.length}evictLeastRecentlyUsed(){let e=null,t=Date.now();for(const[r,s]of this.cache.entries())s.lastAccessed<t&&(t=s.lastAccessed,e=r);e&&(this.cache.delete(e),this.stats.evictions++,I.debug("Evicted LRU cache entry",{component:"SmartCache",additionalData:{evictedKey:e,lastAccessed:new Date(t).toISOString()}}))}estimateCacheSize(){let e=0;for(const t of this.cache.values())e+=JSON.stringify(t).length*2;return e}loadFromStorage(){try{const e=localStorage.getItem(at);if(!e)return;const t=JSON.parse(e),r=Date.now();for(const[s,i]of t.entries||[]){const c={...i,articles:i.articles.map(p=>({...p,pubDate:new Date(p.pubDate)}))};r-c.timestamp<=this.options.enableStaleWhileRevalidate&&this.cache.set(s,c)}I.info("Loaded cache from storage",{component:"SmartCache",additionalData:{loadedEntries:this.cache.size,totalStored:t.entries?.length||0}})}catch(e){I.error("Failed to load cache from storage",e,{component:"SmartCache"}),localStorage.removeItem(at)}}persistToStorage(){try{const e=Array.from(this.cache.entries()).map(([r,s])=>[r,{...s,articles:s.articles.map(i=>({...i,pubDate:i.pubDate.toISOString()}))}]),t={entries:e,timestamp:Date.now(),version:"1.0.0"};localStorage.setItem(at,JSON.stringify(t)),I.debug("Persisted cache to storage",{component:"SmartCache",additionalData:{entriesCount:e.length,estimatedSize:JSON.stringify(t).length}})}catch(e){I.error("Failed to persist cache to storage",e,{component:"SmartCache",additionalData:{cacheSize:this.cache.size,estimatedSize:this.estimateCacheSize()}})}}setupPeriodicCleanup(){setInterval(()=>{this.cleanup()},300*1e3)}}const ht=new Yn({ttl:Qt,maxEntries:en,enablePersistence:!0,enableStaleWhileRevalidate:tn}),Vn=n=>ht.get(n),qn=(n,e,t,r)=>{ht.set(n,e,t,r)},xr=n=>ht.isFresh(n),nn={maxXmlSize:10*1024*1024,allowedRootElements:["rss","feed","rdf:rdf","rdf"],blockedPatterns:[/<!ENTITY[^>]*SYSTEM/i,/<!ENTITY[^>]*PUBLIC/i,/javascript:/gi,/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,/on\w+\s*=\s*["'][^"']*["']/gi,/data:text\/html/gi,/vbscript:/gi,/expression\s*\(/gi]};function rn(n,e){if(n.length>e.maxXmlSize)throw new Error(`XML size exceeds security limit of ${e.maxXmlSize} bytes`);for(const t of e.blockedPatterns)if(t.test(n))throw new Error("Potentially malicious XML content detected: blocked pattern found")}function Kn(n,e){const t=n.documentElement;if(!t)throw new Error("No valid XML root element found");const r=t.tagName.toLowerCase();if(!e.allowedRootElements.some(i=>r===i.toLowerCase()))throw new Error(`Root element '${r}' is not in allowed list: ${e.allowedRootElements.join(", ")}`);const s=Array.from(n.childNodes).filter(i=>i.nodeType===Node.ELEMENT_NODE);if(s.length>1)throw new Error(`XML contains ${s.length} root nodes, but only 1 is allowed`)}function pt(n){if(!n)return"";let e=n;return e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&apos;/g,"'"),e=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/on\w+\s*=\s*["'][^"']*["']/gi,"").replace(/javascript:/gi,"").replace(/vbscript:/gi,"").replace(/data:text\/html/gi,"").replace(/expression\s*\(/gi,"").replace(/<[^>]*>/g,""),e=e.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").trim(),e}function Jn(n,e){if(!n)return"";const r=n.querySelector(e)?.textContent||"";return pt(r)}function Zn(n,e){if(!n)return"";const t=n.getAttribute(e)||"";return pt(t)}function Qn(n,e=nn){try{if(!n||typeof n!="string")throw new Error("Invalid XML input: must be a non-empty string");const t=n.trim();if(!t)throw new Error("Invalid XML input: must be a non-empty string");rn(t,e);const s=new DOMParser().parseFromString(t,"application/xml"),i=s.querySelector("parsererror");if(i)throw new Error(`XML parsing error: ${i.textContent}`);return Kn(s,e),s}catch(t){throw console.error("Secure XML parsing error:",t),new Error(`Failed to parse XML securely: ${t instanceof Error?t.message:"Unknown error"}`)}}function er(n){const e={...nn,allowedRootElements:["rss","feed","rdf:rdf","rdf"]};return Qn(n,e)}const gt={getSecureTextContent:Jn,getSecureAttributeValue:Zn,sanitizeTextContent:pt,validateXmlSecurity:rn},tr=[{original:"http://feeds.feedburner.com/tecnoblog",alternatives:["https://tecnoblog.net/feed/","https://tecnoblog.net/rss/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/Techcrunch",alternatives:["https://techcrunch.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/blogdoiphone/rss",alternatives:["https://blogdoiphone.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://macmagazine.com.br/feed/",alternatives:["https://macmagazine.com.br/feed/"],notes:"HTTP to HTTPS redirect"},{original:"http://feeds2.feedburner.com/canaltechbr",alternatives:["https://canaltech.com.br/rss/","https://canaltech.com.br/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/guiadopc",alternatives:["https://guiadopc.com.br/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://meiobit.com/index.xml",alternatives:["https://meiobit.com/feed/","https://meiobit.com/index.xml"],notes:"HTTP to HTTPS redirect"},{original:"http://feeds.feedburner.com/design-milk",alternatives:["https://design-milk.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/core77/blog",alternatives:["https://www.core77.com/rss/object.xml"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/dezeen",alternatives:["https://www.dezeen.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/JustCreativeDesignBlog",alternatives:["https://justcreative.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds2.feedburner.com/thenextweb",alternatives:["https://thenextweb.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/brainstorm9",alternatives:["https://www.brainstorm9.com/feed/"],notes:"FeedBurner redirect to direct feed"}];function nr(n){const e=[n],t=tr.find(r=>r.original===n);if(t&&e.push(...t.alternatives),n.startsWith("http://")){const r=n.replace("http://","https://");e.includes(r)||e.push(r)}return[...new Set(e)]}const rr=8e3,or=2,sr=500,H=Xn(),ir=[{name:"RSS2JSON",url:"https://api.rss2json.com/v1/api.json",format:n=>`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(n)}`,parser:lr},{name:"AllOrigins",url:"https://api.allorigins.win/raw",format:n=>`https://api.allorigins.win/raw?url=${encodeURIComponent(n)}`,parser:ct},{name:"CodeTabs",url:"https://api.codetabs.com/v1/proxy",format:n=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(n)}`,parser:ct},{name:"CORSProxy",url:"https://corsproxy.io",format:n=>`https://corsproxy.io/?${encodeURIComponent(n)}`,parser:ct}];class ar{constructor(){this.failures=new Map,this.threshold=3,this.timeout=6e4}isOpen(e){const t=this.failures.get(e);return t?Date.now()-t.lastAttempt>this.timeout?(this.failures.delete(e),!1):t.count>=this.threshold:!1}recordFailure(e){const t=this.failures.get(e)||{count:0,lastAttempt:0};t.count++,t.lastAttempt=Date.now(),this.failures.set(e,t)}recordSuccess(e){this.failures.delete(e)}}const ft=new ar;function on(n){return gt.sanitizeTextContent(n)}function ae(n){return gt.sanitizeTextContent(n)}function sn(n){return gt.sanitizeTextContent(n)}async function cr(n,e={}){const{timeout:t=rr,...r}=e,s=new AbortController,i=setTimeout(()=>s.abort(),t);try{const c=await fetch(n,{...r,signal:s.signal,headers:{Accept:"application/rss+xml, application/xml, application/atom+xml, text/xml, application/json, */*",...r.headers}});return clearTimeout(i),c}catch(c){throw clearTimeout(i),c instanceof Error&&c.name==="AbortError"?new Error(`Request timeout after ${t}ms`):c}}function lr(n,e){const t=JSON.parse(n);if(t.status==="error")throw new Error(`RSS2JSON error: ${t.message||"Unknown error"}`);if(t.status!=="ok"||!t.items)throw new Error("Invalid RSS2JSON response format");const r=t.items.map(s=>{let i=s.thumbnail||s.enclosure?.link;if(i)try{new URL(i).protocol.startsWith("http")||(i=void 0),i&&(i.includes("?text=")||i.match(/^[A-Z0-9]{6}\?text=/i)||!i.includes("."))&&(i=void 0)}catch{i=void 0}const c=s.description?on(s.description).substring(0,500):"",d=s.content||s.description||"",p=Zt(d);return{title:s.title?ae(s.title):"No Title",link:s.link||e,pubDate:s.pubDate?new Date(s.pubDate):new Date,description:c,content:p||void 0,sourceTitle:t.feed?.title?ae(t.feed.title):"RSS Feed",author:s.author?sn(s.author):void 0,categories:s.categories||[],imageUrl:i||void 0}});return{title:t.feed?.title||"RSS Feed",articles:r}}function ct(n,e){const t=er(n),r=t.getElementsByTagName("parsererror");if(r.length>0)throw new Error(`XML parsing error: ${r[0].textContent}`);let s="Untitled Feed",i;const c=t.getElementsByTagName("channel");if(c.length>0)s=c[0].getElementsByTagName("title")[0]?.textContent?.trim()||"Untitled Feed",s=ae(s),i=t.getElementsByTagName("item");else{const p=t.getElementsByTagName("feed");if(p.length>0)s=p[0].getElementsByTagName("title")[0]?.textContent?.trim()||"Untitled Feed",s=ae(s),i=t.getElementsByTagName("entry");else{const u=t.getElementsByTagName("item");if(u.length>0){const E=t.getElementsByTagName("channel");E.length>0&&(s=E[0].getElementsByTagName("title")[0]?.textContent?.trim()||"Untitled Feed",s=ae(s)),i=u}else throw new Error("Unsupported RSS format")}}const d=[];for(let p=0;p<Math.min(i.length,50);p++){const u=i[p];try{const b=u.getElementsByTagName("title")[0]?.textContent?.trim()||"No Title",U=ae(b);let z="";const G=u.getElementsByTagName("link");G.length>0&&(z=G[0].textContent?.trim()||G[0].getAttribute("href")||"");let be=new Date;const Pe=u.getElementsByTagName("pubDate"),ke=u.getElementsByTagName("published"),Ue=u.getElementsByTagName("date"),q=Pe[0]||ke[0]||Ue[0];if(q?.textContent){const f=new Date(q.textContent.trim());isNaN(f.getTime())||(be=f)}let y="",F="";const Z=u.getElementsByTagName("description"),ze=u.getElementsByTagName("summary"),Be=u.getElementsByTagName("content"),$e=u.getElementsByTagName("content:encoded"),He=u.getElementsByTagName("body"),_=Z[0]||ze[0];_?.textContent&&(y=_.textContent);const Q=$e[0]||Be[0]||He[0]||Z[0];Q?.textContent&&(F=Q.textContent),!y&&F&&(y=F),!F&&y&&(F=y);const ce=on(y).substring(0,500),le=Zt(F);let Se="";const We=u.getElementsByTagName("author"),Ge=u.getElementsByTagName("creator"),Ae=u.getElementsByTagName("dc:creator"),we=We[0]||Ae[0]||Ge[0];if(we?.textContent){const f=we.textContent.trim();Se=sn(f)}const me=[],S=u.getElementsByTagName("category");for(let f=0;f<S.length;f++){const R=S[f].textContent?.trim();R&&me.push(R)}let x="";const A=u.getElementsByTagName("enclosure");for(let f=0;f<A.length;f++){const R=A[f],B=R.getAttribute("type");if(B&&B.startsWith("image/")){x=R.getAttribute("url")||"";break}}if(!x){const f=u.getElementsByTagName("media:content");for(let R=0;R<f.length;R++){const B=f[R],P=B.getAttribute("type");if(P&&P.startsWith("image/")){x=B.getAttribute("url")||"";break}}}if(!x){const f=u.getElementsByTagName("media:thumbnail");f.length>0&&(x=f[0].getAttribute("url")||"")}if(!x){const f=F||y||"",R=[/<img[^>]+src=["']([^"']+)["'][^>]*>/i,/src=["']([^"']+\.(?:jpg|jpeg|png|gif|webp|svg))[^"']*/i,/https?:\/\/[^\s<>"]+\.(?:jpg|jpeg|png|gif|webp|svg)/i];for(const B of R){const P=f.match(B);if(P&&P[1]){x=P[1];break}}}let ue;if(x)try{const f=new URL(x);(f.protocol==="http:"||f.protocol==="https:")&&!x.includes("?text=")&&!x.match(/^[A-Z0-9]{6}\?text=/i)&&x.includes(".")&&(ue=x)}catch{H.debug(`Invalid image URL filtered: ${x}`,{component:"rssParser"})}U!=="No Title"&&z&&d.push({title:U,link:z,pubDate:be,description:ce,content:le||void 0,imageUrl:ue,author:Se||void 0,categories:me,sourceTitle:s})}catch(E){H.warn(`Failed to parse article ${p+1}`,{component:"rssParser",additionalData:{error:E instanceof Error?E.message:String(E)}})}}return{title:s,articles:d}}function mr(n){if(!n||n.trim().length===0)return!1;const e=n.trim();return e.toLowerCase().includes("<!doctype html")||e.toLowerCase().startsWith("<html")?!1:e.startsWith("<")||e.startsWith("{")}async function ur(n,e,t){if(ft.isOpen(n.name))throw new Error(`Circuit breaker open for ${n.name}`);const r=n.format(e);H.debug(`Trying provider: ${n.name}`,{component:"rssParser",additionalData:{feedUrl:e,proxyUrl:r}});const s=await cr(r,{signal:t});if(!s.ok)throw s.status===422?new Error(`Provider ${n.name} cannot process this feed (422 Unprocessable Entity)`):new Error(`Provider ${n.name} returned ${s.status}: ${s.statusText}`);const i=await s.text();if(!mr(i))throw new Error(`Invalid response from ${n.name}`);const c=n.parser(i,e);if(!c.articles||c.articles.length===0)throw new Error(`No articles parsed from ${n.name}`);return ft.recordSuccess(n.name),H.info(`Successfully fetched via ${n.name}`,{component:"rssParser",additionalData:{feedUrl:e,provider:n.name,articlesCount:c.articles.length}}),c}async function fr(n,e){const t=nr(n);let r=new Error("Unknown error");for(const s of t)for(const i of ir)try{return await ur(i,s,e)}catch(c){r=c instanceof Error?c:new Error(String(c)),ft.recordFailure(i.name),H.debug(`Provider ${i.name} failed for ${s}`,{component:"rssParser",additionalData:{error:r.message}})}throw new Error(`All providers failed. Last error: ${r.message}`)}function dr(n){return new Promise(e=>setTimeout(e,n))}async function hr(n,e={}){const{maxRetries:t=or,signal:r}=e;let s=new Error("Unknown error");for(let i=1;i<=t;i++)try{H.debug(`Fetching feed (attempt ${i}/${t})`,{component:"rssParser",additionalData:{feedUrl:n}});const c=await fr(n,r);return c.articles.length>0&&qn(n,c.articles,c.title),H.info(`Successfully fetched feed on attempt ${i}`,{component:"rssParser",additionalData:{feedUrl:n,articlesCount:c.articles.length,attempt:i}}),c}catch(c){if(s=c instanceof Error?c:new Error(String(c)),r?.aborted)throw new Error("Request was cancelled");if(i===t)break;const d=sr*Math.pow(2,i-1);H.warn(`Attempt ${i} failed, retrying in ${d}ms`,{component:"rssParser",additionalData:{feedUrl:n,error:s.message}}),await dr(d)}throw H.error(`All ${t} attempts failed`,s,{component:"rssParser",additionalData:{feedUrl:n}}),s}async function Rr(n,e={}){const{skipCache:t=!1}=e;if(!t){const r=Vn(n);if(r&&r.length>0)return H.debug("Using cached articles",{component:"rssParser",additionalData:{feedUrl:n,cachedCount:r.length}}),{title:r[0].sourceTitle,articles:r}}try{return await hr(n,e)}catch(r){return H.warn("Creating placeholder for failed feed",{component:"rssParser",additionalData:{url:n,error:r instanceof Error?r.message:String(r)}}),{title:"Feed Unavailable",articles:[{title:"RSS Feed Temporarily Unavailable",link:n,pubDate:new Date,description:"Unable to fetch this RSS feed. This may be due to CORS restrictions or temporary server issues. The feed will be retried automatically.",sourceTitle:"System Notice",categories:["system","unavailable"]}]}}}function Dr(n){const t=new DOMParser().parseFromString(n,"text/xml"),r=[],s=(c,d)=>{const p=c.getAttribute("xmlUrl"),u=c.getAttribute("text")||c.getAttribute("title");if(p)r.push({url:p,title:u||void 0,category:d});else if(c.children.length>0){const E=u||d;for(let b=0;b<c.children.length;b++){const U=c.children[b];U.tagName.toLowerCase()==="outline"&&s(U,E)}}},i=t.getElementsByTagName("body")[0];if(i)for(let c=0;c<i.children.length;c++){const d=i.children[c];d.tagName.toLowerCase()==="outline"&&s(d)}return r}export{_r as a,pr as b,Bn as c,wr as d,Sr as e,Fe as f,Ar as g,Er as h,yr as i,Tr as j,Dr as k,I as l,br as m,Vn as n,Rr as o,zn as p,xr as q,gr as s,Cr as u,$n as v};
