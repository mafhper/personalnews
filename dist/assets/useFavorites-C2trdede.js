import{a as k,r as s,j as F}from"./performance-BuPgOiMU.js";import{f as A}from"./index-DgGObAZ7.js";const E=`data:image/svg+xml;base64,${btoa(`
  <svg width="100" height="100" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#374151;stop-opacity:1" />
        <stop offset="100%" style="stop-color:#1f2937;stop-opacity:1" />
      </linearGradient>
    </defs>
    <rect width="100%" height="100%" fill="url(#grad)" />
  </svg>
`)}`,O=`data:image/svg+xml;base64,${btoa(`
  <svg width="100" height="100" xmlns="http://www.w3.org/2000/svg">
    <rect width="100%" height="100%" fill="#374151" />
    <text x="50%" y="50%" text-anchor="middle" dy=".3em" fill="#ef4444" font-family="Arial" font-size="10">Image Error</text>
  </svg>
`)}`,R=({src:t,alt:i,placeholder:r,className:n="",onLoad:l,onError:c,retryAttempts:d=3,retryDelay:g=1e3,sizes:h="(max-width: 480px) 100vw, (max-width: 768px) 50vw, 33vw",srcSet:w})=>{const[f,v]=s.useState(!1),[p,e]=s.useState(!1),[a,o]=s.useState(!1),[u,I]=s.useState(0),S=s.useRef(null),m=s.useRef(null);s.useEffect(()=>{if(S.current)return m.current=new IntersectionObserver(b=>{const[L]=b;L.isIntersecting&&(e(!0),m.current?.disconnect())},{rootMargin:"100px",threshold:.01}),m.current.observe(S.current),()=>{m.current?.disconnect()}},[]);const x=s.useCallback(()=>{v(!0),o(!1),I(0),l?.()},[l]),D=s.useCallback(()=>{u<d?setTimeout(()=>{I(b=>b+1)},g):(o(!0),c?.())},[u,d,g,c]),y=()=>a?O:p||u>0?t:r||E;return F.jsx("img",{ref:S,src:y(),alt:i,className:`transition-opacity duration-500 ease-in-out ${f?"opacity-100":"opacity-0"} ${n} ${f?"":"bg-gray-800 animate-pulse"}`,onLoad:x,onError:D,loading:"lazy",sizes:h,srcSet:p?w:void 0})},z=k.memo(R),C=t=>{const i=`${t.link}-${t.title}`;let r=0;for(let n=0;n<i.length;n++){const l=i.charCodeAt(n);r=(r<<5)-r+l,r=r&r}return Math.abs(r).toString(36)},T=t=>({id:C(t),title:t.title,link:t.link,pubDate:t.pubDate.toISOString(),sourceTitle:t.sourceTitle,imageUrl:t.imageUrl,description:t.description,author:t.author,categories:t.categories,favoritedAt:new Date().toISOString()}),j=t=>({title:t.title,link:t.link,pubDate:new Date(t.pubDate),sourceTitle:t.sourceTitle,imageUrl:t.imageUrl,description:t.description,author:t.author,categories:t.categories}),H=()=>{const[t,i]=A("favorites-data",{articles:[],lastUpdated:new Date().toISOString()}),r=s.useMemo(()=>t.articles,[t.articles]),n=s.useCallback(e=>{const a=C(e);return r.some(o=>o.id===a)},[r]),l=s.useCallback(e=>{if(n(e))return;const a=T(e);i(o=>({articles:[a,...o.articles],lastUpdated:new Date().toISOString()}))},[n,i]),c=s.useCallback(e=>{const a=C(e);i(o=>({articles:o.articles.filter(u=>u.id!==a),lastUpdated:new Date().toISOString()}))},[i]),d=s.useCallback(e=>{n(e)?c(e):l(e)},[n,l,c]),g=s.useCallback(()=>{i({articles:[],lastUpdated:new Date().toISOString()})},[i]),h=s.useCallback(()=>r.length,[r.length]),w=s.useCallback(()=>{const e={...t,exportedAt:new Date().toISOString(),version:"1.0"};return JSON.stringify(e,null,2)},[t]),f=s.useCallback(e=>{try{const a=JSON.parse(e);if(!a.articles||!Array.isArray(a.articles))throw new Error("Invalid favorites data format");for(const o of a.articles)if(!o.id||!o.title||!o.link||!o.pubDate)throw new Error("Invalid article data in favorites");return i({articles:a.articles,lastUpdated:new Date().toISOString()}),!0}catch(a){return console.error("Failed to import favorites:",a),!1}},[i]),v=s.useCallback(e=>!e||e==="All"?r:r.filter(a=>a.categories?.some(o=>o.toLowerCase()===e.toLowerCase())),[r]),p=s.useCallback(e=>e?r.filter(a=>a.sourceTitle.toLowerCase().includes(e.toLowerCase())||a.author?.toLowerCase().includes(e.toLowerCase())):r,[r]);return{favorites:r,isFavorite:n,addToFavorites:l,removeFromFavorites:c,toggleFavorite:d,clearAllFavorites:g,getFavoritesCount:h,exportFavorites:w,importFavorites:f,getFavoritesByCategory:v,getFavoritesBySource:p}};export{z as L,j as f,H as u};
